<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络知识 | 十月</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/docs/images/7.png">
    <meta name="description" content="vuepress博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true">
    <meta name="x5-fullscreen" content="true">
    <meta name="360-fullscreen" content="true">
    <link rel="preload" href="/docs/assets/css/0.styles.1ad37322.css" as="style"><link rel="preload" href="/docs/assets/js/app.ca99be60.js" as="script"><link rel="preload" href="/docs/assets/js/2.f90869d3.js" as="script"><link rel="preload" href="/docs/assets/js/32.98248ad6.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.4e260648.js"><link rel="prefetch" href="/docs/assets/js/11.c7faf0dc.js"><link rel="prefetch" href="/docs/assets/js/12.4d2c3fa3.js"><link rel="prefetch" href="/docs/assets/js/13.0bca2749.js"><link rel="prefetch" href="/docs/assets/js/14.dd92793f.js"><link rel="prefetch" href="/docs/assets/js/15.eeac8df6.js"><link rel="prefetch" href="/docs/assets/js/16.77c2d47d.js"><link rel="prefetch" href="/docs/assets/js/17.6c52002a.js"><link rel="prefetch" href="/docs/assets/js/18.c007769d.js"><link rel="prefetch" href="/docs/assets/js/19.5b702adb.js"><link rel="prefetch" href="/docs/assets/js/20.8b01c1c8.js"><link rel="prefetch" href="/docs/assets/js/21.f30b63cd.js"><link rel="prefetch" href="/docs/assets/js/22.9270e206.js"><link rel="prefetch" href="/docs/assets/js/23.ea1e1991.js"><link rel="prefetch" href="/docs/assets/js/24.5f38cba3.js"><link rel="prefetch" href="/docs/assets/js/25.6c2aa877.js"><link rel="prefetch" href="/docs/assets/js/26.7f92cc24.js"><link rel="prefetch" href="/docs/assets/js/27.cc2178c9.js"><link rel="prefetch" href="/docs/assets/js/28.0ee493cf.js"><link rel="prefetch" href="/docs/assets/js/29.338f737e.js"><link rel="prefetch" href="/docs/assets/js/3.edb5e83a.js"><link rel="prefetch" href="/docs/assets/js/30.4fb62da0.js"><link rel="prefetch" href="/docs/assets/js/31.a6505a92.js"><link rel="prefetch" href="/docs/assets/js/33.7257a28d.js"><link rel="prefetch" href="/docs/assets/js/34.64629f75.js"><link rel="prefetch" href="/docs/assets/js/35.e7242380.js"><link rel="prefetch" href="/docs/assets/js/36.3bc1c98b.js"><link rel="prefetch" href="/docs/assets/js/37.912b0fe3.js"><link rel="prefetch" href="/docs/assets/js/38.c532bc23.js"><link rel="prefetch" href="/docs/assets/js/4.af1ff500.js"><link rel="prefetch" href="/docs/assets/js/5.dc2b2112.js"><link rel="prefetch" href="/docs/assets/js/6.0e82c544.js"><link rel="prefetch" href="/docs/assets/js/7.30be3a2a.js"><link rel="prefetch" href="/docs/assets/js/8.d653075e.js"><link rel="prefetch" href="/docs/assets/js/9.4e806e1c.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.1ad37322.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/images/7.png" alt="十月" class="logo"> <span class="site-name can-hide">十月</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/blog/" class="nav-link">
  技术博客
</a></div><div class="nav-item"><a href="/docs/JavaScript/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/docs/css/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/docs/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/docs/wx/" class="nav-link">
  wx
</a></div><div class="nav-item"><a href="/docs/http/" class="nav-link router-link-exact-active router-link-active">
  网络
</a></div><div class="nav-item"><a href="/docs/myComponents/" class="nav-link">
  封装组件
</a></div><div class="nav-item"><a href="/docs/utils/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/lovebabyqi/Components" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/blog/" class="nav-link">
  技术博客
</a></div><div class="nav-item"><a href="/docs/JavaScript/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/docs/css/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/docs/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/docs/wx/" class="nav-link">
  wx
</a></div><div class="nav-item"><a href="/docs/http/" class="nav-link router-link-exact-active router-link-active">
  网络
</a></div><div class="nav-item"><a href="/docs/myComponents/" class="nav-link">
  封装组件
</a></div><div class="nav-item"><a href="/docs/utils/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/lovebabyqi/Components" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/http/" class="active sidebar-link">网络知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#网络知识" class="sidebar-link">网络知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#_1-1同源策略" class="sidebar-link">1.1同源策略</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_1-2-tcp三次握手，四次挥手" class="sidebar-link">1.2 TCP三次握手，四次挥手</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_1-3-http状态码" class="sidebar-link">1.3 HTTP状态码</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_1-4-get和post请求的区别" class="sidebar-link">1.4 get和post请求的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/http/#_2-http" class="sidebar-link">2. HTTP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#_2-1-http-简介" class="sidebar-link">2.1 HTTP 简介</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_2-2-http-工作原理" class="sidebar-link">2.2 HTTP 工作原理</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_2-3-http请求方法" class="sidebar-link">2.3 HTTP请求方法</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_2-4-http-content-type" class="sidebar-link">2.4 HTTP content-type</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/http/#_3-ajax原理" class="sidebar-link">3. ajax原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#_3-1-xmlhttprequest对象" class="sidebar-link">3.1.XMLHttpRequest对象</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_3-2-实例化后，我们就可以通过-xhr-来发起一个请求" class="sidebar-link">3.2 实例化后，我们就可以通过 xhr 来发起一个请求</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_3-3-封装ajax" class="sidebar-link">3.3 封装ajax</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_3-4-简化封装" class="sidebar-link">3.4 简化封装</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/http/#_4-axios" class="sidebar-link">4. axios</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#配置优先级" class="sidebar-link">配置优先级</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_4-1-axios拦截器" class="sidebar-link">4.1 axios拦截器</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_4-2-统一get和post的请求格式。" class="sidebar-link">4.2 统一get和post的请求格式。</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/http/#_5-jsonp" class="sidebar-link">5. jsonp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#_5-1-jsonp概念" class="sidebar-link">5.1 jsonp概念</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_5-2-jsonp包" class="sidebar-link">5.2 jsonp包</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_5-3-jsonp使用示例" class="sidebar-link">5.3 jsonp使用示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/http/#_6-nginx基本使用及概念" class="sidebar-link">6. nginx基本使用及概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/http/#_6-1-webstorm链接" class="sidebar-link">6.1 webStorm链接</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_6-2-nginx基本的安装及配置" class="sidebar-link">6.2 nginx基本的安装及配置</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_6-3-nginx反向代理" class="sidebar-link">6.3 nginx反向代理</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_6-4-nginx负载均衡-分发" class="sidebar-link">6.4 nginx负载均衡(分发)</a></li><li class="sidebar-sub-header"><a href="/docs/http/#_6-5-nginx代理多个项目-通过二级域名访问" class="sidebar-link">6.5 nginx代理多个项目(通过二级域名访问)</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="网络知识"><a href="#网络知识" class="header-anchor">#</a> 网络知识</h2> <h3 id="_1-1同源策略"><a href="#_1-1同源策略" class="header-anchor">#</a> 1.1同源策略</h3> <p>同源策略是浏览器的一个安全功能，不同源的客户端脚本在没有明确授权的情况下，不能读写对方资源。所以xyz.com下的js脚本采用ajax读取abc.com里面的文件数据是会被拒绝的。</p> <p>同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。</p> <p><strong>跨域资源的引入是可以的。但是js不能读写加载的内容。如嵌入到页面中的<code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;，&lt;img&gt;，&lt;link&gt;，&lt;iframe&gt;</code>等。</strong></p> <h3 id="_1-2-tcp三次握手，四次挥手"><a href="#_1-2-tcp三次握手，四次挥手" class="header-anchor">#</a> 1.2 TCP三次握手，四次挥手</h3> <h4 id="_1-2-1-为什么http建立连接需要三次握手-不是两次或四次"><a href="#_1-2-1-为什么http建立连接需要三次握手-不是两次或四次" class="header-anchor">#</a> 1.2.1 为什么http建立连接需要三次握手,不是两次或四次?</h4> <p>三次握手之所以是<strong>三次是保证client和server均让对方知道自己的接收和发送能力没问题而保证的最小次数。</strong></p> <p>第一次client =&gt; server 只能server判断出client具备发送能力.</p> <p>第二次 server =&gt; client client就可以判断出server具备发送和接受能力。此时client还需让server知道自己接收能力没问题于是就有了第三次</p> <p>第三次 client =&gt; server 双方均保证了自己的接收和发送能力没有问题</p> <p>其中，为了保证后续的握手是为了应答上一个握手，每次握手都会带一个标识 seq，后续的ACK都会对这个seq进行加一来进行确认。</p> <p>总结:<strong>三次是最少的安全次数,两次不安全,四次浪费资源</strong></p> <h4 id="_1-2-2-结束为什么要四次挥手"><a href="#_1-2-2-结束为什么要四次挥手" class="header-anchor">#</a> 1.2.2 结束为什么要四次挥手?</h4> <p>TCP是全双工信道，何为全双工就是客户端与服务端建立两条通道，</p> <p><strong>通道1:客户端的输出----连接服务端的输入；</strong></p> <p><strong>通道2:客户端的输入----连接服务端的输出。</strong></p> <p>两个通道可以同时工作：客户端向服务端发送信号的同时服务端也可以向客户端发送信号。所以关闭双通道的时候就是这样：</p> <p>客户端：我要关闭输入通道了。 服务端：好的，你关闭吧，我这边也关闭这个通道。</p> <p>服务端：我也要关闭输入通道了。 客户端：好的你关闭吧，我也把这个通道关闭。</p> <h4 id="_1-2-3-三次握手讲解"><a href="#_1-2-3-三次握手讲解" class="header-anchor">#</a> 1.2.3 三次握手讲解</h4> <p>客户端发送位码为syn＝1,随机产生seq number=1234567的数据包到服务器，服务器由SYN=1知道客户端要求建立联机（客户端：我要连接你）</p> <p>服务器收到请求后要确认联机信息，向A发送ack number=(客户端的seq+1),syn=1,ack=1,随机产生seq=7654321的包（服务器：好的，你来连吧）</p> <p>客户端收到后检查ack number是否正确，即第一次发送的seq number+1,以及位码ack是否为1，若正确，客户端会再发送ack number=(服务器的seq+1),ack=1，服务器收到后确认seq值与ack=1则连接建立成功。（客户端：好的，我来了）</p> <h4 id="_1-2-4-tcp关闭连接过程"><a href="#_1-2-4-tcp关闭连接过程" class="header-anchor">#</a> 1.2.4 TCP关闭连接过程</h4> <p>1.Client向Server发送FIN包，表示Client主动要关闭连接，然后进入FIN_WAIT_1状态，等待Server返回ACK包。此后Client不能再向Server发送数据，但能读取数据。</p> <p>2.Server收到FIN包后向Client发送ACK包，然后进入CLOSE_WAIT状态，此后Server不能再读取数据，但可以继续向Client发送数据。</p> <p>3.Client收到Server返回的ACK包后进入FIN_WAIT_2状态，等待Server发送FIN包。</p> <p>4.Server完成数据的发送后，将FIN包发送给Client，然后进入LAST_ACK状态，等待Client返回ACK包，此后Server既不能读取数据，也不能发送数据。</p> <p>5.Client收到FIN包后向Server发送ACK包，然后进入TIME_WAIT状态，接着等待足够长的时间（2MSL）以确保Server接收到ACK包，最后回到CLOSED状态，释放网络资源。</p> <p>6.Server收到Client返回的ACK包后便回到CLOSED状态，释放网络资源。</p> <p><strong>文章地址：by木易杨</strong><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/15" target="_blank" rel="noopener noreferrer">github前端100问<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>原作：猪哥66<a href="https://www.imooc.com/article/287873" target="_blank" rel="noopener noreferrer">猪哥66<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_1-3-http状态码"><a href="#_1-3-http状态码" class="header-anchor">#</a> 1.3 HTTP状态码</h3> <ul><li>1xx（临时响应）表示临时响应并需要请求者继续执行操作的状态码
<ul><li>100 - 继续 请求者应当继续提出请求。服务器返回此代码表示已收到请求的第一部分，正在等待其余部分</li> <li>101 - 切换协议 请求者已要求服务器切换协议，服务器已确认并准备切换</li></ul></li> <li>2xx（成功）表示成功处理了请求的状态码
<ul><li><strong>200 - 成功 服务器已经成功处理了请求。通常，这表示服务器提供了请求的网页</strong></li> <li>201 - 已创建 请求成功并且服务器创建了新的资源</li> <li>202 - 已接受 服务器已接受请求，但尚未处理</li> <li>203 - 非授权信息 服务器已经成功处理了请求，但返回的信息可能来自另一来源</li> <li>204 - 无内容 服务器成功处理了请求，但没有返回任何内容</li> <li>205 - 重置内容 服务器成功处理了请求，但没有返回任何内容</li> <li>206 - 部分内容 服务器成功处理了部分GET请求</li></ul></li> <li>3xx（重定向）表示要完成请求，需要进一步操作；通常，这些状态代码用来重定向
<ul><li>300 - 多种选择 针对请求，服务器可执行多种操作。服务器可根据请求者（user agent）选择一项操作，或提供操作列表供请求者选择</li> <li>301 - 永久移动 请求的网页已永久移动到新位置。服务器返回此响应（对GET或HEAD请求的响应）时，会自动将请求者转到新位置</li> <li>302 - 临时移动 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求</li> <li>303 - 查看其它位置 请求者应当对不同的位置使用单独的GET请求来检索响应时，服务器返回此代码</li> <li>304 - 未修改 自上次请求后，请求的网页未修改过。服务器返回此响应，不会返回网页的内容</li> <li>305 - 使用代理 请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理</li> <li>307 - 临时性重定向 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有的位置来进行以后的请求</li></ul></li> <li>4xx（请求错误）这些状态码表示请求可能出错，妨碍了服务器的处理
<ul><li>400 - 错误请求 服务器不理解请求的语法</li> <li>401 - 未授权 请求要求身份验证。对于需要登录的网页，服务器可能返回此响应</li> <li>403 - 禁止 服务器拒绝请求</li> <li><strong>404 - 未找到 服务器找不到请求的网页</strong></li> <li>405 - 方法禁用 禁用请求中指定的方法</li> <li>406 - 不接受 无法使用请求的内容特性响应请求的网页</li> <li>407 - 需要代理授权 此状态码与401（未授权）类似，但指定请求者应当授权使用代理</li> <li>408 - 请求超时 服务器等候请求时发生超时</li> <li>409 - 冲突 服务器在完成请求时发生冲突。服务器必须在响应中包含有关冲突的信息</li> <li>410 - 已删除 如果请求的资源已永久删除，服务器就会返回此响应</li> <li>411 - 需要有效长度 服务器不接受不含有效内容长度标头字段的请求</li> <li>412 - 未满足前提条件 服务器未满足请求者在请求者设置的其中一个前提条件</li> <li>413 - 请求实体过大 服务器无法处理请求，因为请求实体过大，超出了服务器的处理能力</li> <li>414 - 请求的URI过长 请求的URI（通常为网址）过长，服务器无法处理</li> <li>415 - 不支持媒体类型 请求的格式不受请求页面的支持</li> <li>416 - 请求范围不符合要求 如果页面无法提供请求的范围，则服务器会返回此状态码</li> <li>417 - 未满足期望值 服务器未满足“期望”请求标头字段的要求</li></ul></li> <li>5xx（服务器错误）这些状态码表示服务器在尝试处理请求时发生内部错误。这些错误可能是服务器本身的错误，而不是请求出错
<ul><li><strong>500 - 服务器内部错误 服务器遇到错误，无法完成请求</strong></li> <li>501 - 尚未实施 服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码</li> <li>502 - 错误网关 服务器作为网关或代理，从上游服务器无法收到无效响应</li> <li>503 - 服务器不可用 服务器目前无法使用（由于超载或者停机维护）。通常，这只是暂时状态</li> <li>504 - 网关超时 服务器作为网关代理，但是没有及时从上游服务器收到请求</li> <li>505 - HTTP版本不受支持 服务器不支持请求中所用的HTTP协议版本</li></ul></li></ul> <h3 id="_1-4-get和post请求的区别"><a href="#_1-4-get和post请求的区别" class="header-anchor">#</a> 1.4 get和post请求的区别</h3> <ul><li>GET 参数通过 url 传递，POST 放在 body 中。（http 协议规定，url 在请求头中，所以大小限制很小）</li> <li>GET 请求在 url 中传递的参数是有长度限制的，而 POST 没有。原因见上↑↑↑</li> <li>GET 在浏览器回退时是无害的，而 POST 会再次提交请求</li> <li>GET 请求会被浏览器主动 cache，而 POST 不会，除非手动设置</li> <li>GET 比 POST 更不安全，因为参数直接暴露在 url 中，所以不能用来传递敏感信息</li> <li>对参数的数据类型，GET 只接受 ASCII字符，而 POST 没有限制</li> <li>GET 请求只能进行 url(x-www-form-urlencoded)编码，而 POST 支持多种编码方式</li> <li><strong>GET 产生一个 TCP 数据包；POST 产生两个 TCP 数据包</strong>。对于 GET 方式的请求，浏览器会把 http 的 header 和 data 一并发送出去，服务器响应200（返回数据）。而对于 POST，浏览器先发送 header，服务器响应100 continue，浏览器再发送 data，服务器响应200 ok（返回数据）</li></ul> <h2 id="_2-http"><a href="#_2-http" class="header-anchor">#</a> 2. HTTP</h2> <p><a href="https://www.runoob.com/http/http-tutorial.html" target="_blank" rel="noopener noreferrer">文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_2-1-http-简介"><a href="#_2-1-http-简介" class="header-anchor">#</a> 2.1 HTTP 简介</h3> <p>HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。。</p> <p>HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。</p> <h3 id="_2-2-http-工作原理"><a href="#_2-2-http-工作原理" class="header-anchor">#</a> 2.2 HTTP 工作原理</h3> <p>HTTP协议工作于客户端-服务端架构上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。</p> <p>Web服务器有：Apache服务器，IIS服务器（Internet Information Services）等。</p> <p>Web服务器根据接收到的请求后，向客户端发送响应信息。</p> <p>HTTP默认端口号为80，但是你也可以改为8080或者其他端口。</p> <p><strong>HTTP三点注意事项</strong>：</p> <ul><li><strong>HTTP是无连接</strong>：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</li> <li><strong>HTTP是媒体独立的</strong>：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的<strong>MIME-type内容类型</strong>。</li> <li><strong>HTTP是无状态</strong>：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。</li></ul> <p><strong>MIME-type内容类型</strong>：</p> <p>浏览器显示的内容都有 HTML、XML、GIF、Flash 等，浏览器是通过 MIME Type 区分它们，决定用什么内容什么形式来显示。</p> <p>MIME Type 是该资源的媒体类型，MIME Type 不是个人指定的，是经过互联网（IETF）组织协商，以 RFC（是一系列以编号排定的文件，几乎所有的互联网标准都有收录在其中） 的形式作为建议的标准发布在网上的，大多数的 Web 服务器和用户代理都会支持这个规范 (顺便说一句，Email 附件的类型也是通过 MIME Type 指定的)。</p> <p>媒体类型通常通过 HTTP 协议，由 Web 服务器告知浏览器的，更准确地说，是<strong>通过 Content-Type 来表示</strong>的。例如：Content-Type：text/HTML。</p> <p>通常只有一些卓哉互联网上获得广泛应用的格式才会获得一个 MIME Type，如果是某个客户端自己定义的格式，一般只能以 application/x- 开头。</p> <h3 id="_2-3-http请求方法"><a href="#_2-3-http请求方法" class="header-anchor">#</a> 2.3 HTTP请求方法</h3> <p>HTTP1.0 定义了三种请求方法： GET, POST 和 HEAD方法。</p> <p>HTTP1.1 新增了六种请求方法：OPTIONS、PUT、PATCH、DELETE、TRACE 和 CONNECT 方法。</p> <table><thead><tr><th>方法</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>GET</strong></td> <td>请求指定的页面信息，并返回实体主体。</td></tr> <tr><td>HEAD</td> <td>类似于 GET 请求，只不过返回的响应中没有具体的内容，用于获取报头</td></tr> <tr><td><strong>POST</strong></td> <td>向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST 请求可能会导致新的资源的建立和/或已有资源的修改。</td></tr> <tr><td>PUT</td> <td>从客户端向服务器传送的数据取代指定的文档的内容。</td></tr> <tr><td>DELETE</td> <td>请求服务器删除指定的页面。</td></tr> <tr><td>CONNECT</td> <td>HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。</td></tr> <tr><td>OPTIONS</td> <td>允许客户端查看服务器的性能。</td></tr> <tr><td>TRACE</td> <td>回显服务器收到的请求，主要用于测试或诊断。</td></tr> <tr><td>PATCH</td> <td>是对 PUT 方法的补充，用来对已知资源进行局部更新 。</td></tr></tbody></table> <h3 id="_2-4-http-content-type"><a href="#_2-4-http-content-type" class="header-anchor">#</a> 2.4 HTTP content-type</h3> <p>Content-Type（内容类型），一般是指网页中存在的 Content-Type，用于定义网络文件的类型和网页的编码，决定浏览器将以什么形式、什么编码读取这个文件，这就是经常看到一些 PHP 网页点击的结果却是下载一个文件或一张图片的原因。</p> <p>Content-Type 标头告诉客户端实际返回的内容的内容类型。</p> <p>语法格式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Content<span class="token operator">-</span>Type<span class="token operator">:</span> text<span class="token operator">/</span>html<span class="token punctuation">;</span> charset<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span>
Content<span class="token operator">-</span>Type<span class="token operator">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span> boundary<span class="token operator">=</span>something
</code></pre></div><p>常见格式，上传文件时</p> <ul><li>multipart/form-data ： 需要在表单中进行文件上传时，就需要使用该格式</li></ul> <p>其他格式</p> <ul><li>text/html ： HTML格式</li> <li>text/plain ：纯文本格式</li> <li>text/xml ： XML格式</li> <li>image/gif ：gif图片格式</li> <li>image/jpeg ：jpg图片格式</li> <li>image/png：png图片格式</li></ul> <p>以application开头的媒体格式类型：</p> <ul><li>application/xhtml+xml ：XHTML格式</li> <li>application/xml： XML数据格式</li> <li>application/atom+xml ：Atom XML聚合格式</li> <li>application/json： JSON数据格式</li> <li>application/pdf：pdf格式</li> <li>application/msword ： Word文档格式</li> <li>application/octet-stream ： 二进制流数据（如常见的文件下载）</li> <li>application/x-www-form-urlencoded ： <form encType="””">中默认的encType，form表单数据被编码为key/value格式发送到服务器（表单默认的提交数据的格式）</form></li></ul> <h2 id="_3-ajax原理"><a href="#_3-ajax原理" class="header-anchor">#</a> 3. ajax原理</h2> <h3 id="_3-1-xmlhttprequest对象"><a href="#_3-1-xmlhttprequest对象" class="header-anchor">#</a> 3.1.XMLHttpRequest对象</h3> <p>我们常用的 ajax 就是通过 XMLHttpRequest 对象实现的，这个对象有很多的属性和事件，在使用之前，我们需要先将它实例化 。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-2-实例化后，我们就可以通过-xhr-来发起一个请求"><a href="#_3-2-实例化后，我们就可以通过-xhr-来发起一个请求" class="header-anchor">#</a> 3.2 实例化后，我们就可以通过 xhr 来发起一个请求</h3> <h4 id="_3-2-1-xhr-open"><a href="#_3-2-1-xhr-open" class="header-anchor">#</a> 3.2.1 xhr.open()</h4> <p>xhr 具有一个 open 方法，这个方法的作用类似于初始化，并不会发起真正的请求。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>open 方法具有 5 个参数，但是常用的是前 3 个</p> <p><strong>method： 请求方式 —— get / post</strong></p> <p><strong>url：请求的地址</strong></p> <p><strong>async：是否异步请求，默认为 true（异步）</strong></p> <h4 id="_3-2-2-xhr-send"><a href="#_3-2-2-xhr-send" class="header-anchor">#</a> 3.2.2 xhr.send()</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre></div><p>send 方法发送请求，并接受一个可选参数</p> <p><strong>当请求方式为 post 时，可以将请求体的参数传入</strong></p> <p><strong>当请求方式为 get 时，可以不传或传入 null</strong></p> <p>不管是 get 还是 post，参数都需要通过 <strong>encodeURIComponent</strong> 编码后拼接</p> <p>在通过<strong>send方法发送请求后</strong>，xhr 对象在收到响应数据时会自动填充到其对应的属性中，xhr 具有以下常用属性：</p> <p><strong>responseText</strong>： 请求返回的数据内容</p> <p><strong>responseXML</strong>： 如果响应内容是&quot;text/xml&quot;&quot;application/xml&quot;，这个属性将保存响应数据的 XML DOM文档</p> <p><strong>status</strong>： 响应的HTTP状态，如 200 304 404 等</p> <p><strong>statusText</strong>： HTTP状态说明</p> <p><strong>readyStatus</strong>： 请求/响应过程的当前活动阶段</p> <p><strong>timeout</strong>： 设置请求超时时间</p> <h4 id="_3-2-3-xhr-onreadystatechange"><a href="#_3-2-3-xhr-onreadystatechange" class="header-anchor">#</a> 3.2.3 xhr.onreadystatechange()</h4> <p>readyStatus的值会随着请求各阶段的变化而改变，其一共有 5 个值：</p> <p>xhr.readyStatus==0 尚未调用 open 方法</p> <p>xhr.readyStatus==1 已调用 open 但还未发送请求（未调用 send）</p> <p>xhr.readyStatus==2 已发送请求（已调用 send）</p> <p>xhr.readyStatus==3 已接收到请求返回的数据</p> <p>xhr.readyStatus==4 请求已完成</p> <p>当readyStatus的状态发生改变时，会触发 xhr 的事件onreadystatechange，于是我们就可以在这个方法中，对接收到的数据进行处理</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyStatus <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// HTTP 状态在 200-300 之间表示请求成功</span>
        <span class="token comment">// HTTP 状态为 304 表示请求内容未发生改变，可直接从缓存中读取</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> 
            xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> 
            xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-2-4-当网络不佳时，我们需要给请求设置一个超时时间"><a href="#_3-2-4-当网络不佳时，我们需要给请求设置一个超时时间" class="header-anchor">#</a> 3.2.4 当网络不佳时，我们需要给请求设置一个超时时间</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 超时时间单位为毫秒</span>
xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token comment">// 当请求超时时，会触发 ontimeout 方法</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求超时'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-3-封装ajax"><a href="#_3-3-封装ajax" class="header-anchor">#</a> 3.3 封装ajax</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> options<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token keyword">const</span> method <span class="token operator">=</span> options<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'get'</span>
    <span class="token keyword">const</span> async <span class="token operator">=</span> options<span class="token punctuation">.</span>async <span class="token operator">!=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// default is true</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>timeout <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>timeout <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> options<span class="token punctuation">.</span>timeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> reject <span class="token operator">&amp;&amp;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'请求超时'</span><span class="token punctuation">)</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                	resolve <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                	reject <span class="token operator">&amp;&amp;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> reject <span class="token operator">&amp;&amp;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> paramArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> encodeData<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            	<span class="token comment">// 参数拼接需要通过 encodeURIComponent 进行编码</span>
            	paramArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        	encodeData <span class="token operator">=</span> paramArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 检测 url 中是否已存在 ? 及其位置</span>
            <span class="token keyword">const</span> index <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> url <span class="token operator">+=</span> <span class="token string">'?'</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> url<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> url <span class="token operator">+=</span> <span class="token string">'&amp;'</span>
            <span class="token comment">// 拼接 url</span>
            url <span class="token operator">+=</span> encodeData
        <span class="token punctuation">}</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
        	<span class="token comment">// post 方式需要设置请求头</span>
        	xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'application/x-www-form-urlencoded;charset=UTF-8'</span><span class="token punctuation">)</span>
        	xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>encodeData<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方式:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'your request url'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        aaa<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求成功: '</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-4-简化封装"><a href="#_3-4-简化封装" class="header-anchor">#</a> 3.4 简化封装</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">jsonUrl</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>	<span class="token comment">//处理get参数</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> key<span class="token operator">+</span><span class="token string">'='</span><span class="token operator">+</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
    json<span class="token punctuation">.</span>data <span class="token operator">=</span> json<span class="token punctuation">.</span>data<span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//默认数据为空</span>
    json<span class="token punctuation">.</span>type <span class="token operator">=</span> json<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'GET'</span><span class="token punctuation">;</span>
    json<span class="token punctuation">.</span>timeout <span class="token operator">=</span> json<span class="token punctuation">.</span>timeout<span class="token operator">||</span><span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span><span class="token punctuation">{</span>
        xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>		<span class="token comment">//IE5 IE6</span>
        xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">'Microsoft.XMLHTTP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'GET'</span><span class="token operator">:</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span>json<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">'?'</span><span class="token operator">+</span><span class="token function">jsonUrl</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'POST'</span><span class="token operator">:</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>json<span class="token punctuation">.</span>url<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span> <span class="token function">jsonUrl</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token operator">===</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">&gt;=</span><span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status<span class="token operator">&lt;</span><span class="token number">300</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                json<span class="token punctuation">.</span>success <span class="token operator">&amp;&amp;</span> json<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                json<span class="token punctuation">.</span>error <span class="token operator">&amp;&amp;</span> json<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方式:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'your request url'</span><span class="token punctuation">,</span>	<span class="token comment">//必传</span>
    type<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>	<span class="token comment">//默认get</span>
    <span class="token comment">//async: true,	//默认true</span>
    timeout<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>	<span class="token comment">//默认1000</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        aaa<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//请求成功执行的回调</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//请求失败执行</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_4-axios"><a href="#_4-axios" class="header-anchor">#</a> 4. axios</h2> <p><a href="http://www.axios-js.com/" target="_blank" rel="noopener noreferrer">axios官方文档地址。<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.jianshu.com/p/7a9fbcbb1114" target="_blank" rel="noopener noreferrer">axios简书文档。<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="配置优先级"><a href="#配置优先级" class="header-anchor">#</a> 配置优先级</h3> <p>配置项通过一定的规则合并，<code>request config</code> &gt; <code>instance.defaults</code> &gt; <code>系统默认</code>，优先级高的覆盖优先级低的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建一个实例，这时的超时时间为系统默认的 0</span>
<span class="token keyword">var</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过instance.defaults重新设置超时时间为2.5s，因为优先级比系统默认高</span>
instance<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2500</span><span class="token punctuation">;</span>

<span class="token comment">// 通过request config重新设置超时时间为5s，因为优先级比instance.defaults和系统默认都高</span>
instance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/longRequest'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	timeout<span class="token operator">:</span> <span class="token number">5000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-1-axios拦截器"><a href="#_4-1-axios拦截器" class="header-anchor">#</a> 4.1 axios拦截器</h3> <p>首先，拦截的目的作用可能是登录状态校验，设置统一请求格式，统一响应头</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>  <span class="token comment">//引入axios</span>
<span class="token comment">//下面这两个不一定需要引入，看你项目需要拦截的时候做什么操作，但是一般都需要引入store</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span>  <span class="token comment">//引入router</span>
</code></pre></div><p>创建一个axios实例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    	<span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span><span class="token number">5000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>请求拦截</p> <p>每次请求判断token</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// http request 拦截器</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
    <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//do something</span>
    	<span class="token keyword">const</span> token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 判断是否存在token，如果存在的话，则每个http header都加上token</span>
    		config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization <span class="token operator">=</span> token  <span class="token comment">//请求头加上token</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'/login'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    	<span class="token keyword">return</span> config
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>响应拦截</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
    <span class="token parameter">response</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	<span class="token comment">// do something with response data</span>
    	<span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	<span class="token comment">// do something with response error</span>
    	<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-2-统一get和post的请求格式。"><a href="#_4-2-统一get和post的请求格式。" class="header-anchor">#</a> 4.2 统一get和post的请求格式。</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token comment">//设置axios超时时间</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
<span class="token comment">//设置axios响应数据的统一格式</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//暴露一个名字是axios的函数</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//url请求的地址</span>
    <span class="token comment">//data 请求时发送的数据</span>
    <span class="token comment">//method 请求的方式</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果请求是get方式</span>
            p <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                params<span class="token operator">:</span>data
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            p <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用示例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'./request'</span>

<span class="token comment">//暴露请求的接口函数供组件使用</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reqLogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userInfo</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>userInfo<span class="token punctuation">,</span><span class="token string">'post'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_5-jsonp"><a href="#_5-jsonp" class="header-anchor">#</a> 5. jsonp</h2> <h3 id="_5-1-jsonp概念"><a href="#_5-1-jsonp概念" class="header-anchor">#</a> 5.1 jsonp概念</h3> <p><strong>JSONP是JSON with padding(填充式JSON或参数式JSON)的简写，是应用JSON的一种新方法，常用于服务器与客户端跨源通信</strong> 。</p> <p>JSONP的产生</p> <p>1、一个众所周知的问题，Ajax直接请求普通文件存在跨域无权限访问的问题，甭管你是静态页面、动态网页、web服务、WCF，只要是跨域请求，一律不准。</p> <p>2、不过我们又发现，Web页面上调用js文件时则不受是否跨域的影响（不仅如此，我们还发现凡是拥有”src”这个属性的标签都拥有跨域的能力，比如&lt;\script&gt;、&lt;\img&gt;、&lt;\iframe&gt;）。</p> <p>3、于是可以判断，当前阶段如果想通过纯web端（ActiveX控件、服务端代理、属于未来的HTML5之Websocket等方式不算）跨域访问数据就只有一种可能，那就是在远程服务器上设法把数据装进js格式的文件里，供客户端调用和进一步处理。</p> <p>4、恰巧我们已经知道有一种叫做JSON的纯字符数据格式可以简洁的描述复杂数据，更妙的是JSON还被js原生支持，所以在客户端几乎可以随心所欲的处理这种格式的数据。</p> <p>5、这样子解决方案就呼之欲出了，web客户端通过与调用脚本一模一样的方式，来调用跨域服务器上动态生成的js格式文件（一般以JSON为后缀），显而易见，服务器之所以要动态生成JSON文件，目的就在于把客户端需要的数据装入进去。</p> <p>6、客户端在对JSON文件调用成功之后，也就获得了自己所需的数据，剩下的就是按照自己需求进行处理和展现了，这种获取远程数据的方式看起来非常像AJAX，但其实并不一样。</p> <p>7、为了便于客户端使用数据，逐渐形成了一种非正式传输协议，人们把它称作JSONP，该协议的一个要点就是允许用户传递一个callback参数给服务端，然后服务端返回数据时会将这个callback参数作为函数名来包裹住JSON数据，这样客户端就可以随意定制自己的函数来自动处理返回数据了。</p> <h3 id="_5-2-jsonp包"><a href="#_5-2-jsonp包" class="header-anchor">#</a> 5.2 jsonp包</h3> <p>npm提供了jsonp包</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add <span class="token operator">--</span>save jsonp
</code></pre></div><p>使用jsonp跨域请求数据,jsonp方法接收三个参数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">jsonp</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>options<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>1. url 跨域请求的地址</strong></p> <p><strong>2. options配置对象</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    params<span class="token operator">:</span>String<span class="token punctuation">,</span><span class="token comment">//指定会掉的查询字符串参数</span>
    timeout<span class="token operator">:</span>Number<span class="token punctuation">,</span><span class="token comment">//超时时间,默认6000,0禁用</span>
    prefix<span class="token operator">:</span>String<span class="token punctuation">,</span><span class="token comment">//处理jsonp响应的全局回调函数前缀,默认__jp</span>
	name<span class="token operator">:</span>String<span class="token punctuation">,</span><span class="token comment">//处理jsonp响应的全局回调函数的名称,默认prefix+incremented counter(递增计数器)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>3. fn回调函数</strong></p> <p>回调函数接收两个参数err，data。</p> <p>如果超时，err将是一个Error对象,错误信息是Timeout。</p> <p>jsonp返回一个函数，该函数在被调用时将取消正在进行的jsonp请求(fn不会被调用)。</p> <h3 id="_5-3-jsonp使用示例"><a href="#_5-3-jsonp使用示例" class="header-anchor">#</a> 5.3 jsonp使用示例</h3> <p>要请求一个天气接口,获取天气信息</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">reqWeather</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://www.tianqiapi.com/api/?version=v1&amp;ip&amp;appid=92468752&amp;appsecret=KD1hiiGZ'</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">jsonp</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">res</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>  <span class="token comment">//如果是非法的城市名 就弹窗提示</span>
                message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'非法的城市名'</span><span class="token punctuation">)</span>
                <span class="token comment">// res('非法的城市名')</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-nginx基本使用及概念"><a href="#_6-nginx基本使用及概念" class="header-anchor">#</a> 6. nginx基本使用及概念</h2> <h3 id="_6-1-webstorm链接"><a href="#_6-1-webstorm链接" class="header-anchor">#</a> 6.1 webStorm链接</h3> <p>链接服务器, 在服务器上面操作</p> <ol><li>用ws 打开你要上传的项目</li> <li>用ws 链接远程服务器
<ol><li>tools =&gt; deployment =&gt; remote</li> <li>... =&gt; 新建一个链接</li> <li>设置链接 ip 账号 密码</li> <li>超级管理员 root 密码 刚才设置的密码</li> <li>登录 (能看到文件目录)</li> <li>linux哲学: linux认为你会知道你在做什么, 所以你的任何指令都会执行</li> <li>linux哲学: 没有消息就是最好的消息</li></ol></li> <li>ssh指令窗口 tools =&gt; ssh 链接 选择你的服务器
<ol><li>ls 显示当前文件夹的内容 -a</li> <li>cd 进入某个文件夹 ../ 上级文件夹 ./ 当前文件夹 / 根目录 clear</li></ol></li></ol> <h3 id="_6-2-nginx基本的安装及配置"><a href="#_6-2-nginx基本的安装及配置" class="header-anchor">#</a> 6.2 nginx基本的安装及配置</h3> <ol><li><p>apt-get (ubuntu) yum(centOS) 快速下载安装某些东西</p></li> <li><p>apt-get update 更新apt-get包的文件目录</p></li> <li><p>安装nginx</p></li> <li><p>apt-get install nginx 中间要按一下回车等待(此时访问服务器地址能看到nginx欢迎页)</p></li> <li><p>配置一下 nginx的展示以及路径--&gt;6.3</p></li> <li><p>我们要做什么?</p> <ol><li><p>上线项目nginx</p> <p>nginx 会对请求进行处理</p> <p>分发:</p> <ol><li>分发给不同的服务器(反向代理)</li> <li>分发给不同的本地端口(做到同时部署多个项目在本地)</li></ol></li> <li><p><strong>node 环境安装</strong></p> <ol><li>apt-get install npm 安装npm包</li> <li>npm i -g n 全局安装n</li> <li>n latest 安装最新版本的node</li></ol></li> <li><p>nginx 的 网页展示</p> <ol><li><p>配置文件 /etc/nginx/nginx.conf</p> <p>第一行 user 后面改成root</p></li></ol></li></ol></li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token number">118.190</span><span class="token number">.96</span><span class="token number">.203</span><span class="token punctuation">;</span>
    <span class="token comment"># 这是注释, 访问根路由</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token comment"># 默认走 /root/www/ 去寻找文件</span>
        <span class="token keyword">root</span> <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>www<span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token comment"># 默认打开index.html文件</span>
        <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-3-nginx反向代理"><a href="#_6-3-nginx反向代理" class="header-anchor">#</a> 6.3 nginx反向代理</h3> <p>nginx 重启(启动) service nginx restart</p> <p>在 /root/www/ 目录中上传文件</p> <ol><li><p>转发到本地 3000端口 (反向代理)</p> <ol><li><p>/etc/nginx/nginx.conf</p></li> <li><p>安装pm2 后台运行</p> <p>npm i pm2 -g全局安装pm2</p></li></ol></li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>www<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token number">118.190</span><span class="token number">.96</span><span class="token number">.203</span><span class="token punctuation">;</span>
        <span class="token comment"># 这是注释, 访问根路由</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token comment"># 转发到本地3000端口</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-4-nginx负载均衡-分发"><a href="#_6-4-nginx负载均衡-分发" class="header-anchor">#</a> 6.4 nginx负载均衡(分发)</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 转发器</span>
<span class="token keyword">upstream</span> backend <span class="token punctuation">{</span>
    <span class="token comment"># 3000和3001端口打包在一起,50%概率,可以加权重</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">3001</span> weight<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>www<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token number">118.190</span><span class="token number">.96</span><span class="token number">.203</span><span class="token punctuation">;</span>
    <span class="token comment"># 这是注释, 访问根路由</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token comment"># 默认走 /root/www/ 去寻找文件</span>
        <span class="token comment"># 默认打开index.html文件</span>
        <span class="token comment"># index index.html;</span>
        <span class="token comment"># 转发到本地3000端口</span>
        <span class="token comment"># proxy_pass http://localhost:3000;</span>
        <span class="token comment"># 转发到分发器处理</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li><p>启动带mongdb的项目</p> <p>也是需要安装的</p> <p>apt-get install mongdb</p> <p>启动mongodb</p> <p>mongod --dbpath .. --logpath .. --fork #fork常驻启动</p></li></ol> <h3 id="_6-5-nginx代理多个项目-通过二级域名访问"><a href="#_6-5-nginx代理多个项目-通过二级域名访问" class="header-anchor">#</a> 6.5 nginx代理多个项目(通过二级域名访问)</h3> <h4 id="_6-5-1-前后台代码整合"><a href="#_6-5-1-前后台代码整合" class="header-anchor">#</a> 6.5.1 前后台代码整合</h4> <p><strong>1.打包前台代码，存放到后台的public目录下，后台配置了static静态资源访问，</strong></p> <p><strong>就能直接从后台代码作为入口，访问整合后的项目。</strong></p> <p><strong>2.React,Vue都是单页面SPA应用,前台路由是不会发起网络请求的，但是F5刷新会发起请求。此时由于后台根本没有对应的中间件处理函数，刷新引起的请求得不到响应，404。</strong></p> <p>解决方案,模拟脚手架功能；本地开发的时候F5刷新，脚手架给我们返回了一个index.html</p> <p>项目整合后，我们可以在后台代码中模拟</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 配置前台路由 把前台打包放到Public目录下,可解决单页面刷新问题</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    cxt<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html;charset=UTF-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">'/public/index.html'</span><span class="token punctuation">)</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> data
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样就能解决整合上线后刷新404问题</p> <h4 id="_6-5-2-nginx-同一个端口代理多个项目-通过二级域名访问服务器不同本地端口"><a href="#_6-5-2-nginx-同一个端口代理多个项目-通过二级域名访问服务器不同本地端口" class="header-anchor">#</a> 6.5.2 Nginx 同一个端口代理多个项目,通过二级域名访问服务器不同本地端口</h4> <h5 id="_1-首先到服务器添加解析记录设置好二级域名解析"><a href="#_1-首先到服务器添加解析记录设置好二级域名解析" class="header-anchor">#</a> 1.首先到服务器添加解析记录设置好二级域名解析</h5> <p>例如我的域名 baidu.com</p> <p>二级域名1 nec.baidu.com</p> <p>二级域名2 ra.baidu.com</p> <h5 id="_2-到服务器上传项目"><a href="#_2-到服务器上传项目" class="header-anchor">#</a> 2.到服务器上传项目</h5> <p>在www目录下建两个文件夹 ,</p> <p>项目一是一个网易云API工具,我放在/root/www/NetEasyCloud目录下,项目使用3000端口</p> <p>项目二是一个react+antd+node项目,放在/root/www/react-antd目录下,项目使用3001端口</p> <h5 id="_3-检查上传的项目启动是否正常-依赖包安装完先启动看能不能正常运行"><a href="#_3-检查上传的项目启动是否正常-依赖包安装完先启动看能不能正常运行" class="header-anchor">#</a> 3.检查上传的项目启动是否正常,依赖包安装完先启动看能不能正常运行</h5> <p>最重要的一步!!!</p> <h5 id="_4-配置nginx-server-etc-nginx-nginx-server"><a href="#_4-配置nginx-server-etc-nginx-nginx-server" class="header-anchor">#</a> 4.配置nginx.server /etc/nginx/nginx.server</h5> <p>1.第一行 user root;</p> <p>2.配置server</p> <p>这里要注意server文件在编辑器没有语法报错提示,注意分号,空格,花括号完整!!!</p> <p>server{ } 可以配置多个</p> <p>server_name可以配置多个域名 ,用空格隔开,就能实现多个地址指向一个项目</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
   <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
   <span class="token comment"># 之前把第一个3000端口项目放在了NetEasyCloud目录下</span>
   <span class="token keyword">root</span> <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>www<span class="token operator">/</span>NetEasyCloud<span class="token operator">/</span><span class="token punctuation">;</span>
   <span class="token comment"># server_name 监听你的域名,设置成你的对应二级域名就行</span>
   <span class="token keyword">server_name</span> nec<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
   <span class="token comment"># 这是注释, 访问根路由/    这里的路由也可以设置访问路径</span>
   <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
       <span class="token comment"># 默认打开index.html文件</span>
       <span class="token comment">#index index.html;</span>
       <span class="token comment">#转发到本地的3000端口,这里指的3000是在指服务器上本地运行项目的3000端口</span>
       <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment">#    这里是配置nginx  gzip压缩加速 这段代码可以放到server外面</span>
<span class="token keyword">gzip</span> on<span class="token punctuation">;</span>
<span class="token keyword">gzip_buffers</span> <span class="token number">32</span> <span class="token number">4</span>k<span class="token punctuation">;</span>
<span class="token keyword">gzip_comp_level</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token keyword">gzip_min_length</span> <span class="token number">200</span><span class="token punctuation">;</span>
<span class="token keyword">gzip_types</span> text<span class="token operator">/</span>css text<span class="token operator">/</span>xml application<span class="token operator">/</span>javascript<span class="token punctuation">;</span>
<span class="token keyword">gzip_vary</span> on<span class="token punctuation">;</span>
</code></pre></div><h5 id="_5-配置完成后保存nginx-config上传-链接ssh-启动服务-使用pm2管理"><a href="#_5-配置完成后保存nginx-config上传-链接ssh-启动服务-使用pm2管理" class="header-anchor">#</a> 5.配置完成后保存nginx.config上传,链接ssh 启动服务(使用pm2管理)</h5> <div class="language-nginx extra-class"><pre class="language-nginx"><code>pm2 stop all    <span class="token operator">/</span><span class="token operator">/</span>停止运行所有项目
pm2 start app<span class="token punctuation">.</span>js    <span class="token operator">/</span><span class="token operator">/</span>进入到项目文件夹找到入口文件<span class="token punctuation">,</span>通过pm2启动
<span class="token operator">/</span><span class="token operator">/</span>两个项目都启动之后开启nginx
service nginx stop   <span class="token operator">/</span><span class="token operator">/</span>关闭nginx服务
service nginx start  <span class="token operator">/</span><span class="token operator">/</span>开启nginx服务
</code></pre></div><p>没有报错!!!nginx启动无异常</p> <p>去访问二级域名 nec.baidu.com 指向网易云api项目</p> <p>ra.baidu.com 指向react项目</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-5-21 22:55:10</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.ca99be60.js" defer></script><script src="/docs/assets/js/2.f90869d3.js" defer></script><script src="/docs/assets/js/32.98248ad6.js" defer></script>
  </body>
</html>
