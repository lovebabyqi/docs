<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node相关 | 十月</title>
    <meta name="generator" content="VuePress 1.4.1">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/docs/utils/utils.js"></script>
    <link rel="icon" href="/docs/images/7.png">
    <meta name="description" content="vuepress博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true">
    <meta name="x5-fullscreen" content="true">
    <meta name="360-fullscreen" content="true">
    <link rel="preload" href="/docs/assets/css/0.styles.4581c035.css" as="style"><link rel="preload" href="/docs/assets/js/app.496b0931.js" as="script"><link rel="preload" href="/docs/assets/js/2.f90869d3.js" as="script"><link rel="preload" href="/docs/assets/js/38.ec811ecb.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.4e260648.js"><link rel="prefetch" href="/docs/assets/js/11.c7faf0dc.js"><link rel="prefetch" href="/docs/assets/js/12.e2e451d7.js"><link rel="prefetch" href="/docs/assets/js/13.0bca2749.js"><link rel="prefetch" href="/docs/assets/js/14.e9248f0f.js"><link rel="prefetch" href="/docs/assets/js/15.891e4394.js"><link rel="prefetch" href="/docs/assets/js/16.e00288bc.js"><link rel="prefetch" href="/docs/assets/js/17.1a83ea74.js"><link rel="prefetch" href="/docs/assets/js/18.c007769d.js"><link rel="prefetch" href="/docs/assets/js/19.ba43cd67.js"><link rel="prefetch" href="/docs/assets/js/20.8b01c1c8.js"><link rel="prefetch" href="/docs/assets/js/21.9e67312b.js"><link rel="prefetch" href="/docs/assets/js/22.b41c324e.js"><link rel="prefetch" href="/docs/assets/js/23.52d4b090.js"><link rel="prefetch" href="/docs/assets/js/24.a9d72343.js"><link rel="prefetch" href="/docs/assets/js/25.4e243327.js"><link rel="prefetch" href="/docs/assets/js/26.786162a2.js"><link rel="prefetch" href="/docs/assets/js/27.f9a5939b.js"><link rel="prefetch" href="/docs/assets/js/28.a50fece0.js"><link rel="prefetch" href="/docs/assets/js/29.ddc7618f.js"><link rel="prefetch" href="/docs/assets/js/3.edb5e83a.js"><link rel="prefetch" href="/docs/assets/js/30.274da36f.js"><link rel="prefetch" href="/docs/assets/js/31.de01ef66.js"><link rel="prefetch" href="/docs/assets/js/32.699dd8b4.js"><link rel="prefetch" href="/docs/assets/js/33.b65b59da.js"><link rel="prefetch" href="/docs/assets/js/34.7281d86e.js"><link rel="prefetch" href="/docs/assets/js/35.71f8e7df.js"><link rel="prefetch" href="/docs/assets/js/36.f9ffcd58.js"><link rel="prefetch" href="/docs/assets/js/37.944918a2.js"><link rel="prefetch" href="/docs/assets/js/39.d39702a2.js"><link rel="prefetch" href="/docs/assets/js/4.af1ff500.js"><link rel="prefetch" href="/docs/assets/js/40.f0b6f971.js"><link rel="prefetch" href="/docs/assets/js/41.f6b18c0a.js"><link rel="prefetch" href="/docs/assets/js/42.e6e82b74.js"><link rel="prefetch" href="/docs/assets/js/43.fd9d0a1a.js"><link rel="prefetch" href="/docs/assets/js/5.2d8eeb88.js"><link rel="prefetch" href="/docs/assets/js/6.0e82c544.js"><link rel="prefetch" href="/docs/assets/js/7.30be3a2a.js"><link rel="prefetch" href="/docs/assets/js/8.d653075e.js"><link rel="prefetch" href="/docs/assets/js/9.022925d2.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.4581c035.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/images/7.png" alt="十月" class="logo"> <span class="site-name can-hide">十月</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/blog/" class="nav-link">
  技术博客
</a></div><div class="nav-item"><a href="/docs/JavaScript/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/docs/jQuery/" class="nav-link">
  jQuery
</a></div><div class="nav-item"><a href="/docs/css/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/docs/ts/" class="nav-link">
  ts
</a></div><div class="nav-item"><a href="/docs/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link router-link-exact-active router-link-active">
  node
</a></div><div class="nav-item"><a href="/docs/wx/" class="nav-link">
  wx
</a></div><div class="nav-item"><a href="/docs/http/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/docs/myComponents/" class="nav-link">
  封装组件
</a></div><div class="nav-item"><a href="/docs/utils/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/lovebabyqi/Components" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/blog/" class="nav-link">
  技术博客
</a></div><div class="nav-item"><a href="/docs/JavaScript/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/docs/jQuery/" class="nav-link">
  jQuery
</a></div><div class="nav-item"><a href="/docs/css/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/docs/ts/" class="nav-link">
  ts
</a></div><div class="nav-item"><a href="/docs/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link router-link-exact-active router-link-active">
  node
</a></div><div class="nav-item"><a href="/docs/wx/" class="nav-link">
  wx
</a></div><div class="nav-item"><a href="/docs/http/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/docs/myComponents/" class="nav-link">
  封装组件
</a></div><div class="nav-item"><a href="/docs/utils/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/lovebabyqi/Components" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/node/" class="active sidebar-link">node相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_1-fs-file-system-模块" class="sidebar-link">1.fs(file system)模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_1-1-读" class="sidebar-link">1.1 读</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_1-2-写" class="sidebar-link">1.2 写</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_1-3-其余方法" class="sidebar-link">1.3 其余方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-path" class="sidebar-link">2. path</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-1-常用来读取或上传文件时设置路径" class="sidebar-link">2.1.常用来读取或上传文件时设置路径</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-2-快速创建自定义目录" class="sidebar-link">2.2 快速创建自定义目录</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-3-包管理器" class="sidebar-link">2.3 包管理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-3-1-npm-全称：node-package-manager（node的包管理器）" class="sidebar-link">2.3.1 npm  全称：node package manager（node的包管理器）</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-4-cmd简单命令" class="sidebar-link">2.4 cmd简单命令</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-5-express" class="sidebar-link">2.5 express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-5-1-express模块动态路由" class="sidebar-link">2.5.1 express模块动态路由</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-5-2-experss获取post数据" class="sidebar-link">2.5.2 experss获取post数据</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-5-3-洋葱模型" class="sidebar-link">2.5.3 洋葱模型</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-6-koa" class="sidebar-link">2.6 koa</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-6-1-koa示例" class="sidebar-link">2.6.1 koa示例:</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-7-使用koa-multer上传图片" class="sidebar-link">2.7 使用koa-multer上传图片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-7-1-form表单提交-form提交可以跨域" class="sidebar-link">2.7.1 form表单提交(form提交可以跨域)</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-7-2multer配置" class="sidebar-link">2.7.2multer配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-8-node-js-buffer-缓冲区" class="sidebar-link">2.8 Node.js Buffer 缓冲区</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-8-1-buffer" class="sidebar-link">2.8.1 Buffer</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-8-2-缓冲区" class="sidebar-link">2.8.2 缓冲区</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-8-3-base64" class="sidebar-link">2.8.3 Base64</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-9-node事件循环机制" class="sidebar-link">2.9 node事件循环机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-9-1-异步任务的分类" class="sidebar-link">2.9.1 异步任务的分类</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-9-2-执行机制" class="sidebar-link">2.9.2 执行机制</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-10-cookie和session" class="sidebar-link">2.10 cookie和session</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/#_2-10-1-概念" class="sidebar-link">2.10.1 概念</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-10-2-express的cookie" class="sidebar-link">2.10.2 express的cookie</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-10-3-express的session" class="sidebar-link">2.10.3 express的session</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-10-4-koa2的cookie" class="sidebar-link">2.10.4 koa2的cookie</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-10-5-koa2的session" class="sidebar-link">2.10.5 koa2的session</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-11-spa单页应用刷新404问题" class="sidebar-link">2.11 SPA单页应用刷新404问题</a></li><li class="sidebar-sub-header"><a href="/docs/node/#_2-12-linux下快速删除" class="sidebar-link">2.12 linux下快速删除</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node相关"><a href="#node相关" class="header-anchor">#</a> node相关</h1> <p><a href="http://nodejs.cn/api/" target="_blank" rel="noopener noreferrer">node官方文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_1-fs-file-system-模块"><a href="#_1-fs-file-system-模块" class="header-anchor">#</a> 1.fs(file system)模块</h2> <h3 id="_1-1-读"><a href="#_1-1-读" class="header-anchor">#</a> 1.1 读</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>文件的路径<span class="token punctuation">,</span>回调函数<span class="token punctuation">)</span>
	<span class="token comment">//回调函数    异步的</span>
	err  <span class="token comment">//如果文件的路径不存在 则err就是一个错误对象</span>
	data <span class="token comment">//如果文件的路径存在 则data就是读取出的数据  数据是Buffer格式的</span>
	Buffer<span class="token comment">//格式的数据可以使用toString()转成字符串</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>文件的路径<span class="token punctuation">)</span>  
	<span class="token comment">//这个函数是同步的 函数的返回值是读取文件的数据</span>
</code></pre></div><p>fs模块读取到的内容是Buffer格式</p> <p><strong>示例:fs存取一张图片,读取到的内容是buffer</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/public/uploads/001.jpg'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bufferData <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//得到的是buffer格式字符串</span>
<span class="token comment">//buffer展示为16进制&lt;Buffer ff d8 ff e0 00 10 4a 46 49 46 00 01 01 01 00 48 00 48...</span>

<span class="token comment">//bufferData.toString('base64')方法可以将buffer转为字符串 base64位</span>

<span class="token keyword">const</span> base64Data <span class="token operator">=</span> bufferData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>

<span class="token comment">//再从base64转回buffer,并存图片,看什么效果</span>
<span class="token keyword">const</span> newBufferData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>base64Data<span class="token punctuation">,</span><span class="token string">'base64'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> newFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/public/uploads/003.jpg'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>newFilePath<span class="token punctuation">,</span>newBufferData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//这么做是因为目前只知道fs存图片用Buffer</span>
</code></pre></div><h3 id="_1-2-写"><a href="#_1-2-写" class="header-anchor">#</a> 1.2 写</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>异步 
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./1.txt'</span><span class="token punctuation">,</span><span class="token string">'我是海文'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
	参数<span class="token number">1</span><span class="token operator">:</span>路径<span class="token punctuation">,</span>参数二<span class="token operator">:</span>数据<span class="token punctuation">,</span>参数<span class="token number">3</span><span class="token operator">:</span>回调函数
同步
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'路径'</span><span class="token punctuation">,</span>数据<span class="token punctuation">)</span>
<span class="token comment">//需要注意,写文件操作时,如果路径存在(即文件存在),是修改文件内容</span>
<span class="token comment">//如果路径不存在(文件不存在),才是创建文件,写入内容</span>
</code></pre></div><h3 id="_1-3-其余方法"><a href="#_1-3-其余方法" class="header-anchor">#</a> 1.3 其余方法</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//删除文件</span>
fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token string">'D:/Windows 7 Documents/Desktop/正则题目答案1.html'</span><span class="token punctuation">)</span>

<span class="token comment">//创建新的空文件夹</span>
fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">'D:/Windows 7 Documents/Desktop/day02'</span><span class="token punctuation">)</span>

<span class="token comment">//删除指定的文件夹</span>
fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span><span class="token string">'D:/Windows 7 Documents/Desktop/day02'</span><span class="token punctuation">)</span>


<span class="token comment">//读取指定文件夹的数据</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'D:/Windows 7 Documents/Desktop/test'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//查看文件/文件夹的状态</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token string">'D:/Windows 7 Documents/Desktop/1.mp4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//判断文件是否存在</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">'./buffer1.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//rename(老路径,新路径,回调函数)  把原来的文件从老路径移到新路径 并且修改文件名</span>
fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'D:/Windows 7 Documents/Desktop/1.js'</span><span class="token punctuation">,</span><span class="token string">'./buffer.js'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">/*
*   只要文件的状态改变了就会触发回调函数  nextStat是改变后的文件状态 preStat改变前的文件状态
*   watchFile(文件的路径,监听的频率,回调函数)
* */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">watchFile</span><span class="token punctuation">(</span><span class="token string">'./1.txt'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>interval<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nextStat<span class="token punctuation">,</span>preStat</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextStat<span class="token punctuation">.</span>size<span class="token punctuation">,</span>preStat<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-path"><a href="#_2-path" class="header-anchor">#</a> 2. path</h2> <h3 id="_2-1-常用来读取或上传文件时设置路径"><a href="#_2-1-常用来读取或上传文件时设置路径" class="header-anchor">#</a> 2.1.常用来读取或上传文件时设置路径</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'images'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//当前所处目录拼接上'/images'  /会自动处理</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//这个模块专门用来处理路径</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span>

<span class="token comment">//序列化路径 返回一个对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//查看文件的后缀名</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//返回最后一个\后面的数据</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//返回最后一个\前面的数据</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-2-快速创建自定义目录"><a href="#_2-2-快速创建自定义目录" class="header-anchor">#</a> 2.2 快速创建自定义目录</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">file</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>fileData<span class="token punctuation">}</span> <span class="token operator">=</span> data
    <span class="token comment">//如果heaven文件夹已经存在  就不创建了</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//如果文件夹不存在  就创建文件夹</span>
        fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span>type<span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
            <span class="token keyword">const</span> fullpath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>name<span class="token punctuation">,</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token operator">===</span><span class="token string">'dir'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//如果type是dir 就创建文件夹</span>
                fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>fullpath<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>fullpath<span class="token punctuation">,</span><span class="token string">'我是html文件'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>file<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./file'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> programeData <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'heaven'</span><span class="token punctuation">,</span>  <span class="token comment">//heaven文件夹</span>
    fileData<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'css'</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span><span class="token string">'dir'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'js'</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span><span class="token string">'dir'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'images'</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span><span class="token string">'dir'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'index.html'</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span><span class="token string">'file'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token function">file</span><span class="token punctuation">(</span>programeData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2-3-包管理器"><a href="#_2-3-包管理器" class="header-anchor">#</a> 2.3 包管理器</h2> <h3 id="_2-3-1-npm-全称：node-package-manager（node的包管理器）"><a href="#_2-3-1-npm-全称：node-package-manager（node的包管理器）" class="header-anchor">#</a> 2.3.1 npm  全称：node package manager（node的包管理器）</h3> <p><strong>node的模块分类</strong>
核心模块：<strong>fs path http url querystring</strong>
自定义模块：自己写的模块
第三方模块：别人写的模块</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm
    开发环境：在开发阶段运行的代码    <span class="token operator">--</span>save<span class="token operator">-</span>dev  <span class="token operator">-</span><span class="token constant">D</span>
    生产环境：当代码开发完毕 投放给用户使用时运行的代码  <span class="token operator">--</span>save  <span class="token operator">-</span><span class="token constant">S</span>  默认

    <span class="token operator">-</span>g 全局安装 在任何目录下都可以使用cnpm指令 相当于环境变量

    npm init <span class="token operator">-</span>y 初始化项目文件
    npm install 包名      下载包
    npm uninstall 包名     删除包
    npm install     自动下载<span class="token keyword">package</span><span class="token punctuation">.</span>json文件中的依赖
</code></pre></div><h2 id="_2-4-cmd简单命令"><a href="#_2-4-cmd简单命令" class="header-anchor">#</a> 2.4 cmd简单命令</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cmd命令  command

window<span class="token operator">+</span><span class="token constant">R</span> <span class="token function">打开命cmd窗口</span><span class="token punctuation">(</span>命令行窗口 黑窗口<span class="token punctuation">)</span>

d<span class="token operator">:</span>  切到d盘目录
cd  <span class="token operator">--</span><span class="token operator">&gt;</span> change directory 跳转目录
cd <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>  跳到上一级目录
cd <span class="token operator">/</span>    跳到根目录
mkdir <span class="token operator">--</span><span class="token operator">&gt;</span>  make directory 创建目录
rmdir <span class="token operator">--</span><span class="token operator">&gt;</span>  remove directory 删除目录

cd<span class="token punctuation">.</span><span class="token operator">&gt;</span> <span class="token number">1.</span>txt      创建<span class="token number">1.</span>txt文件
del <span class="token number">1.</span>txt       删除<span class="token number">1.</span>txt文件
<span class="token number">1.</span>txt          打开当前的目录中的<span class="token number">1.</span>txt文件
</code></pre></div><h2 id="_2-5-express"><a href="#_2-5-express" class="header-anchor">#</a> 2.5 express</h2> <h3 id="_2-5-1-express模块动态路由"><a href="#_2-5-1-express模块动态路由" class="header-anchor">#</a> 2.5.1 express模块动态路由</h3> <p><strong>get数据:req.params</strong></p> <p><strong>post数据 req.body</strong></p> <p><strong>返回数据给前台 res.send</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//引入express包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//前台的多个路径都可以匹配到后台的一个路径	动态路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/article/:id/:xxx'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// let {id} = req.params</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//自动为public目录中的文件设置路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3002</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3002端口成功运行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-5-2-experss获取post数据"><a href="#_2-5-2-experss获取post数据" class="header-anchor">#</a> 2.5.2 experss获取post数据</h3> <p>解析post数据需要用到body-parser</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//引入express包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//使用bodyParser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//接受post方式发送的数据</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/heaven'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'post请求过来了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    <span class="token comment">// res.end({name:'heaven'})</span>
    <span class="token comment">//send函数是express新增的 这个方法可以发送数组和对象给前台</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//自动为public目录中的文件设置路由	静态资源访问</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3001端口成功运行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-5-3-洋葱模型"><a href="#_2-5-3-洋葱模型" class="header-anchor">#</a> 2.5.3 洋葱模型</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//引入express包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//触发下个一个中间件函数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token comment">// next()</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/new'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3003</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3003端口成功运行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-6-koa"><a href="#_2-6-koa" class="header-anchor">#</a> 2.6 koa</h2> <p><strong>get数据: cxt.params</strong></p> <p><strong>post数据 cxt.request.body</strong></p> <p><strong>返回数据给前台 cxt.body</strong></p> <p>安装依赖:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add <span class="token operator">--</span>save koa koa<span class="token operator">-</span><span class="token keyword">static</span> koa<span class="token operator">-</span>router koa<span class="token operator">-</span>bodyparser 
</code></pre></div><h3 id="_2-6-1-koa示例"><a href="#_2-6-1-koa示例" class="header-anchor">#</a> 2.6.1 koa示例:</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//管理静态资源</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//管理路由</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token comment">//设置绝对路径需要用到</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//解析post数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//配置路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'public'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/heaven'</span><span class="token punctuation">,</span><span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行'</span><span class="token punctuation">,</span>cxt<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    <span class="token comment">//返回数据</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        status<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//动态路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:id'</span><span class="token punctuation">,</span><span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//  console.log('执行',cxt.params)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> cxt<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">5001</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5001端口成功运行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>koa可以使用koa-cors包,允许跨域请求</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add koa<span class="token operator">-</span>cors
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//允许跨域请求</span>
</code></pre></div><h2 id="_2-7-使用koa-multer上传图片"><a href="#_2-7-使用koa-multer上传图片" class="header-anchor">#</a> 2.7 使用koa-multer上传图片</h2> <h3 id="_2-7-1-form表单提交-form提交可以跨域"><a href="#_2-7-1-form表单提交-form提交可以跨域" class="header-anchor">#</a> 2.7.1 form表单提交(form提交可以跨域)</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://localhost:3000/img/upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>input<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-7-2multer配置"><a href="#_2-7-2multer配置" class="header-anchor">#</a> 2.7.2multer配置</h3> <p><strong>相关依赖:</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>koa koa<span class="token operator">-</span>bodyparser koa<span class="token operator">-</span><span class="token keyword">static</span> koa<span class="token operator">-</span>multer koa<span class="token operator">-</span>router
</code></pre></div><p><strong>上传成功后,返回图片url</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> BodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Static <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-multer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>imgUpload<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./controller/imgController'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">BodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">Static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//文件上传配置</span>
<span class="token keyword">var</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//文件保存路径</span>
    <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'public/uploads/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//修改文件名称</span>
    <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> extname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//拿到后缀名</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">+</span> extname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// cb(null, file.originalname);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//加载配置</span>
<span class="token keyword">var</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> storage<span class="token operator">:</span> storage <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//上传地址,这里的images和form表单提交保持一致</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/img/upload'</span><span class="token punctuation">,</span>upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>imgUpload<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3000端口开启成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>imgUpload</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">imgUpload</span> <span class="token operator">=</span>  <span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//拿到保存的文件名,拼接目录路径</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>filename<span class="token punctuation">}</span> <span class="token operator">=</span> cxt<span class="token punctuation">.</span>req<span class="token punctuation">.</span>file
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        status<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span><span class="token string">'图片上传成功'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span>filename<span class="token punctuation">,</span>
            url<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-8-node-js-buffer-缓冲区"><a href="#_2-8-node-js-buffer-缓冲区" class="header-anchor">#</a> 2.8 Node.js Buffer 缓冲区</h2> <h3 id="_2-8-1-buffer"><a href="#_2-8-1-buffer" class="header-anchor">#</a> 2.8.1 Buffer</h3> <p>Buffer 是存放二进制数据容器，类似 Python 的 Byte 类型。参考 - <a href="https://www.jmjc.tech/tutorial/python/sub-1" target="_blank" rel="noopener noreferrer">字符编码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> &amp; <a href="https://www.jmjc.tech/tutorial/python/86" target="_blank" rel="noopener noreferrer">Base64<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// utf-8 编码 </span>
jmjc_utf8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'简明教程'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jmjc_utf8<span class="token punctuation">)</span> <span class="token comment">// &lt;Buffer e7 ae 80 e6 98 8e e6 95 99 e7 a8 8b&gt;</span>

<span class="token comment">// utf-8 解码</span>
jmjc <span class="token operator">=</span> jmjc_utf8<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jmjc<span class="token punctuation">)</span> <span class="token comment">// 简明教程</span>
</code></pre></div><h3 id="_2-8-2-缓冲区"><a href="#_2-8-2-缓冲区" class="header-anchor">#</a> 2.8.2 缓冲区</h3> <p>Buffer 除了转码的作用外，它更多时候还用作缓冲区，用于数据的缓存。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 定义一个10字节的 Buffer</span>
buf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span> <span class="token comment">// 缓存数据</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token comment">// &lt;Buffer 2e 2e 2e 00 00 00 00 00 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ...</span>
</code></pre></div><h3 id="_2-8-3-base64"><a href="#_2-8-3-base64" class="header-anchor">#</a> 2.8.3 Base64</h3> <p><strong>Buffer 的 toString 方法，还提供了 Base64 数据的转换。</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'JavaScript'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>
<span class="token comment">// SmF2YVNjcmlwdA==</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'SmF2YVNjcmlwdA=='</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// JavaScript</span>
</code></pre></div><h2 id="_2-9-node事件循环机制"><a href="#_2-9-node事件循环机制" class="header-anchor">#</a> 2.9 node事件循环机制</h2> <h3 id="_2-9-1-异步任务的分类"><a href="#_2-9-1-异步任务的分类" class="header-anchor">#</a> 2.9.1 异步任务的分类</h3> <p>1.闳任务  macrotask</p> <ul><li><p>setTimeout的回调</p></li> <li><p>setInterval的回调</p></li></ul> <p>2.微任务  microtask</p> <ul><li>Promise.then的回调</li></ul> <h3 id="_2-9-2-执行机制"><a href="#_2-9-2-执行机制" class="header-anchor">#</a> 2.9.2 执行机制</h3> <h4 id="_1-node中"><a href="#_1-node中" class="header-anchor">#</a> 1.node中</h4> <p>先执行完 本次遇到的所有的闳任务</p> <p>再执行本次遇到的微任务</p> <h4 id="_2-浏览器端"><a href="#_2-浏览器端" class="header-anchor">#</a> 2.浏览器端</h4> <p>先执行闳任务 并且把本次闳任务遇到的微任务执行完</p> <p>再执行下一次的闳任务  并且把本次闳任务遇到的微任务执行完</p> <p>如此循环</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  <span class="token comment">//宏1</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//微1</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//微3</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span>

        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer3'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>        <span class="token comment">//宏2</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//微2</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//微4</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise4'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-10-cookie和session"><a href="#_2-10-cookie和session" class="header-anchor">#</a> 2.10 cookie和session</h2> <h3 id="_2-10-1-概念"><a href="#_2-10-1-概念" class="header-anchor">#</a> 2.10.1 概念</h3> <h4 id="cookie和session"><a href="#cookie和session" class="header-anchor">#</a> cookie和session</h4> <p>都是把数据储存起来<strong>储存时间的自已定义的，即使浏览器关闭了数据依旧会储存</strong></p> <p><strong>cookie的原理</strong></p> <p>在用户第一次访问某个网站的时候，是不会携带cookie的，服务器会让浏览器再一次访问的时候必须携带指定的cookie。再第二次访问服务器的时候，如果浏览器携带的cookie和服务器要求的cookie是一样，则服务器就认识了指定的用户。</p> <p><strong>session的原理</strong></p> <p>在用户第一次访问某个网站的时候，是不会携带cookie的，服务器会让浏览器再一次访问的时候必须携带指定的cookie（A），同时还会在服务端生成一个session，这个session是以指定的cookie(A)为属性名的。再第二次访问服务器的时候，如果浏览器携带的cookie和服务器session中cookie属性名是一样。则服务器就认识了指定的用户</p> <p><strong>cookie特点</strong></p> <ul><li>存储在浏览器</li> <li>不安全</li> <li>存储数据的量比较小 4M</li></ul> <p><strong>session特点</strong></p> <ul><li>依赖于cookie实现的</li> <li>存储在服务端</li> <li>安全</li> <li>存储数据的量比较大</li></ul> <p>Storage也可以存储数据</p> <p><strong>localStorage</strong></p> <ul><li>存储数据的时间：永久</li> <li>如果浏览器卸载，数据才会消失</li></ul> <p><strong>sessionStorage</strong></p> <ul><li>存储数据的时间：一次浏览器窗口周期 ，打开浏览器窗口到关闭浏览器窗口的时间差</li></ul> <h3 id="_2-10-2-express的cookie"><a href="#_2-10-2-express的cookie" class="header-anchor">#</a> 2.10.2 express的cookie</h3> <p>依赖:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add <span class="token operator">--</span>save cookie<span class="token operator">-</span>parser
</code></pre></div><p>示例:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//获取所有去过的城市</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">===</span><span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span><span class="token keyword">return</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>express_cookie_city<span class="token operator">||</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你的足迹是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cityArr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:city'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">===</span><span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span><span class="token keyword">return</span>
    <span class="token comment">//获取当前city</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token comment">//读取cookie</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>express_cookie_city<span class="token operator">||</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    
    cityArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span>
    
    <span class="token comment">//使用res响应体对象  来让前台存储cookie</span>
    <span class="token comment">//res.cookie(属性名，属性值，cookie的存储时长)</span>
    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'express_cookie_city'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cityArr<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        maxAge<span class="token operator">:</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token comment">//存储时间为60个小时</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你今天去的城市是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3000端口成功运行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-10-3-express的session"><a href="#_2-10-3-express的session" class="header-anchor">#</a> 2.10.3 express的session</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    secret<span class="token operator">:</span> <span class="token string">'keyboard cat'</span><span class="token punctuation">,</span>
    resave<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span><span class="token string">'heaven'</span><span class="token punctuation">,</span>  <span class="token comment">//设置的cookie的属性名</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    cookie<span class="token operator">:</span> <span class="token punctuation">{</span>
        secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//可以不写</span>
        maxAge<span class="token operator">:</span><span class="token number">80000</span><span class="token punctuation">,</span><span class="token comment">//必须</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//获取所有去过的城市</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">===</span><span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span><span class="token keyword">return</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>express_session_city<span class="token operator">||</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你的足迹是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cityArr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:city'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">===</span><span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span><span class="token keyword">return</span>
    <span class="token comment">//获取当前city</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token comment">//读取session</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>express_session_city<span class="token operator">||</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    <span class="token comment">//把这次去的地方添加到上次去的数组中</span>
    cityArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span>
    <span class="token comment">//设置session</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>express_session_city <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cityArr<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你今天去的城市是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3004</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3004端口成功运行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-10-4-koa2的cookie"><a href="#_2-10-4-koa2的cookie" class="header-anchor">#</a> 2.10.4 koa2的cookie</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//配置路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">cxt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//读取cookie</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cxt<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'koa2_cookie_city'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'[]'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cityArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你今天去的城市是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cityArr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:city'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">cxt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">=</span> cxt<span class="token punctuation">.</span>params
    <span class="token comment">//读取cookie</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cxt<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'koa2_cookie_city'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'[]'</span><span class="token punctuation">)</span>
    <span class="token comment">//把这次去的地方添加到上次去的数组中</span>
    cityArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span>
    <span class="token comment">//cxt.cookies.set(属性名,属性值,时长)</span>
    cxt<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'koa2_cookie_city'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cityArr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        maxAge<span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">,</span>   <span class="token comment">//存储60个小时</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你今天去的城市是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3000端口成功启动'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-10-5-koa2的session"><a href="#_2-10-5-koa2的session" class="header-anchor">#</a> 2.10.5 koa2的session</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-session'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//配置koa-session</span>
app<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'some secret hurr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    key<span class="token operator">:</span> <span class="token string">'heaven'</span><span class="token punctuation">,</span> <span class="token comment">/** (string) cookie key (default is koa:sess) **/</span>
    <span class="token comment">/** (number || 'session') maxAge in ms (default is 1 days) **/</span>
    <span class="token comment">/** 'session' will result in a cookie that expires when session/browser is closed **/</span>
    <span class="token comment">/** Warning: If a session cookie is stolen, this cookie will never expire **/</span>
    maxAge<span class="token operator">:</span> <span class="token number">86400000</span><span class="token punctuation">,</span>
    autoCommit<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">/** (boolean) automatically commit headers (default true) **/</span>
    overwrite<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">/** (boolean) can overwrite or not (default true) **/</span>
    httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">/** (boolean) httpOnly or not (default true) */</span>
    signed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">/** (boolean) signed or not (default true) **/</span>
    rolling<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">/** (boolean) Force a session identifier cookie to be set on every response. The expiration is reset to the original maxAge, resetting the expiration countdown. (default is false) **/</span>
    renew<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">/** (boolean) renew session when session is nearly expired, so we can always keep user logged in. (default is false)**/</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//配置路由  在中间件的最下面</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>cxt<span class="token punctuation">.</span>url<span class="token operator">===</span><span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span><span class="token keyword">return</span>
    <span class="token comment">//读取session</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cxt<span class="token punctuation">.</span>session<span class="token punctuation">.</span>koa2_session_city<span class="token operator">||</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你今天去的城市是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cityArr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:city'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>cxt<span class="token punctuation">.</span>url<span class="token operator">===</span><span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span><span class="token keyword">return</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">=</span> cxt<span class="token punctuation">.</span>params
    <span class="token comment">//读取session</span>
    <span class="token keyword">const</span> cityArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cxt<span class="token punctuation">.</span>session<span class="token punctuation">.</span>koa2_session_city<span class="token operator">||</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    <span class="token comment">//把这次去的地方添加到上次去的数组中</span>
    cityArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span>
    <span class="token comment">// console.log(cityArr);</span>
    <span class="token comment">//设置session</span>
    cxt<span class="token punctuation">.</span>session<span class="token punctuation">.</span>koa2_session_city <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cityArr<span class="token punctuation">)</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你今天去的城市是</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3002</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3002端口成功启动'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-11-spa单页应用刷新404问题"><a href="#_2-11-spa单页应用刷新404问题" class="header-anchor">#</a> 2.11 SPA单页应用刷新404问题</h2> <p>React,Vue都是单页面SPA应用，前台路由是不会发起网络请求的，但是F5刷新会发起请求。此时由于后台根本没有对应的中间件处理函数，刷新引起的请求得不到响应，404。</p> <p>解决方案：模拟脚手架功能。本地开发的时候F5刷新，脚手架给我们返回了一个index.html</p> <p>项目整合后，我们可以在后台代码中模拟</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 配置前台路由 把前台打包放到Public目录下,可解决单页面刷新问题</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">cxt</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    cxt<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html;charset=UTF-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">'/public/index.html'</span><span class="token punctuation">)</span>
    cxt<span class="token punctuation">.</span>body <span class="token operator">=</span> data
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-12-linux下快速删除"><a href="#_2-12-linux下快速删除" class="header-anchor">#</a> 2.12 linux下快速删除</h2> <p>当我们在<code>linux</code>系统中要删除数万或者数十万甚至数百万的文件时使用<code>rm -rf *</code>就不太好用，因为要等待很长一段时间。在这种情况之下我们可以使用<code>linux</code>系统命令<code>rsync</code>来巧妙的处理。<code>rsync</code>实际上用的是替换原理，处理数十万个文件也是秒删。</p> <p>1.先新建一个空目录用于替换</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>mkdir <span class="token operator">/</span>data<span class="token operator">/</span>blank 
</code></pre></div><p>2.用rsync快速替换实现清空文件夹(绝对路径)</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>rsync <span class="token operator">--</span>delete<span class="token operator">-</span>before <span class="token operator">-</span>d <span class="token operator">-</span>a <span class="token operator">-</span>H <span class="token operator">-</span>v <span class="token operator">--</span>progress <span class="token operator">--</span>stats <span class="token operator">/</span>data<span class="token operator">/</span>blank<span class="token operator">/</span> <span class="token operator">/</span>var<span class="token operator">/</span>edatacache<span class="token operator">/</span>
<span class="token comment"># 或者</span>
rsync <span class="token operator">--</span>delete<span class="token operator">-</span>before <span class="token operator">-</span>d <span class="token operator">/</span>data<span class="token operator">/</span>blank<span class="token operator">/</span> <span class="token operator">/</span>var<span class="token operator">/</span>edatacache<span class="token operator">/</span>
</code></pre></div><p>这样edatacache就被清空了</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>选项说明：
–delete<span class="token operator">-</span>before 接收者在传输之前进行删除操作
–progress          在传输时显示传输过程
<span class="token operator">-</span>a                       归档模式，表示以递归方式传输文件，并保持所有文件属性
<span class="token operator">-</span>H                      保持硬连接的文件
<span class="token operator">-</span>v                       详细输出模式
–stats                给出某些文件的传输状态
<span class="token operator">-</span>d                      transfer directories without recursing
</code></pre></div><p>3.也可以用来删除大文件</p> <blockquote><p>假如我们在/root/下有一个几十G甚至上百G的文件data，现在我们要删除它</p></blockquote> <p>创建一个空文件</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code> touch <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>empty
</code></pre></div><p>用rsync清空/root/data文件</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code> rsync <span class="token operator">--</span>delete<span class="token operator">-</span>before <span class="token operator">-</span>d <span class="token operator">--</span>progess <span class="token operator">--</span>stats <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>empty <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>data
</code></pre></div><blockquote><p>当SRC和DEST文件性质不一致时将会报错
当SRC和DEST性质都为文件【f】时，意思是清空文件内容而不是删除文件
当SRC和DEST性质都为目录【d】时，意思是删除该目录下的所有文件，使其变为空目录</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-7-8 12:01:03</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.496b0931.js" defer></script><script src="/docs/assets/js/2.f90869d3.js" defer></script><script src="/docs/assets/js/38.ec811ecb.js" defer></script>
  </body>
</html>
