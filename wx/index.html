<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序 | 十月</title>
    <meta name="generator" content="VuePress 1.4.1">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/docs/utils/utils.js"></script>
    <link rel="icon" href="/docs/images/7.png">
    <meta name="description" content="vuepress博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true">
    <meta name="x5-fullscreen" content="true">
    <meta name="360-fullscreen" content="true">
    <link rel="preload" href="/docs/assets/css/0.styles.4581c035.css" as="style"><link rel="preload" href="/docs/assets/js/app.496b0931.js" as="script"><link rel="preload" href="/docs/assets/js/2.f90869d3.js" as="script"><link rel="preload" href="/docs/assets/js/42.e6e82b74.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.4e260648.js"><link rel="prefetch" href="/docs/assets/js/11.c7faf0dc.js"><link rel="prefetch" href="/docs/assets/js/12.e2e451d7.js"><link rel="prefetch" href="/docs/assets/js/13.0bca2749.js"><link rel="prefetch" href="/docs/assets/js/14.e9248f0f.js"><link rel="prefetch" href="/docs/assets/js/15.891e4394.js"><link rel="prefetch" href="/docs/assets/js/16.e00288bc.js"><link rel="prefetch" href="/docs/assets/js/17.1a83ea74.js"><link rel="prefetch" href="/docs/assets/js/18.c007769d.js"><link rel="prefetch" href="/docs/assets/js/19.ba43cd67.js"><link rel="prefetch" href="/docs/assets/js/20.8b01c1c8.js"><link rel="prefetch" href="/docs/assets/js/21.9e67312b.js"><link rel="prefetch" href="/docs/assets/js/22.b41c324e.js"><link rel="prefetch" href="/docs/assets/js/23.52d4b090.js"><link rel="prefetch" href="/docs/assets/js/24.a9d72343.js"><link rel="prefetch" href="/docs/assets/js/25.4e243327.js"><link rel="prefetch" href="/docs/assets/js/26.786162a2.js"><link rel="prefetch" href="/docs/assets/js/27.f9a5939b.js"><link rel="prefetch" href="/docs/assets/js/28.a50fece0.js"><link rel="prefetch" href="/docs/assets/js/29.ddc7618f.js"><link rel="prefetch" href="/docs/assets/js/3.edb5e83a.js"><link rel="prefetch" href="/docs/assets/js/30.274da36f.js"><link rel="prefetch" href="/docs/assets/js/31.de01ef66.js"><link rel="prefetch" href="/docs/assets/js/32.699dd8b4.js"><link rel="prefetch" href="/docs/assets/js/33.b65b59da.js"><link rel="prefetch" href="/docs/assets/js/34.7281d86e.js"><link rel="prefetch" href="/docs/assets/js/35.71f8e7df.js"><link rel="prefetch" href="/docs/assets/js/36.f9ffcd58.js"><link rel="prefetch" href="/docs/assets/js/37.944918a2.js"><link rel="prefetch" href="/docs/assets/js/38.ec811ecb.js"><link rel="prefetch" href="/docs/assets/js/39.d39702a2.js"><link rel="prefetch" href="/docs/assets/js/4.af1ff500.js"><link rel="prefetch" href="/docs/assets/js/40.f0b6f971.js"><link rel="prefetch" href="/docs/assets/js/41.f6b18c0a.js"><link rel="prefetch" href="/docs/assets/js/43.fd9d0a1a.js"><link rel="prefetch" href="/docs/assets/js/5.2d8eeb88.js"><link rel="prefetch" href="/docs/assets/js/6.0e82c544.js"><link rel="prefetch" href="/docs/assets/js/7.30be3a2a.js"><link rel="prefetch" href="/docs/assets/js/8.d653075e.js"><link rel="prefetch" href="/docs/assets/js/9.022925d2.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.4581c035.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/images/7.png" alt="十月" class="logo"> <span class="site-name can-hide">十月</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/blog/" class="nav-link">
  技术博客
</a></div><div class="nav-item"><a href="/docs/JavaScript/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/docs/jQuery/" class="nav-link">
  jQuery
</a></div><div class="nav-item"><a href="/docs/css/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/docs/ts/" class="nav-link">
  ts
</a></div><div class="nav-item"><a href="/docs/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/docs/wx/" class="nav-link router-link-exact-active router-link-active">
  wx
</a></div><div class="nav-item"><a href="/docs/http/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/docs/myComponents/" class="nav-link">
  封装组件
</a></div><div class="nav-item"><a href="/docs/utils/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/lovebabyqi/Components" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/blog/" class="nav-link">
  技术博客
</a></div><div class="nav-item"><a href="/docs/JavaScript/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/docs/jQuery/" class="nav-link">
  jQuery
</a></div><div class="nav-item"><a href="/docs/css/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/docs/ts/" class="nav-link">
  ts
</a></div><div class="nav-item"><a href="/docs/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/docs/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/docs/wx/" class="nav-link router-link-exact-active router-link-active">
  wx
</a></div><div class="nav-item"><a href="/docs/http/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/docs/myComponents/" class="nav-link">
  封装组件
</a></div><div class="nav-item"><a href="/docs/utils/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/lovebabyqi/Components" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/wx/" class="active sidebar-link">小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#_1-1-rpx-wxss" class="sidebar-link">1.1 rpx wxss</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#wxss小程序样式特性：" class="sidebar-link">wxss小程序样式特性：</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#wxss-选择器" class="sidebar-link">wxss 选择器</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-2-小程序结构" class="sidebar-link">1.2 小程序结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#入口文件-app-js" class="sidebar-link">入口文件 app.js</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#全局配置文件-app-json" class="sidebar-link">全局配置文件 app.json</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-3-小程序生命周期" class="sidebar-link">1.3 小程序生命周期</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-4-小程序页面生命周期" class="sidebar-link">1.4 小程序页面生命周期</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-5-用户行为" class="sidebar-link">1.5 用户行为</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#onpulldownrefresh" class="sidebar-link">onPullDownRefresh</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#onshareappmessage" class="sidebar-link">onShareAppMessage</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-6-简易双向数据绑定" class="sidebar-link">1.6 简易双向数据绑定</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-7-事件" class="sidebar-link">1.7 事件</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-8-setdata-方法" class="sidebar-link">1.8 setData 方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#setdata理解" class="sidebar-link">setData理解</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#setdata几种操作不可取" class="sidebar-link">setData几种操作不可取</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-9-插值" class="sidebar-link">1.9 插值{{ }}</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-10-条件渲染" class="sidebar-link">1.10 条件渲染</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-11-列表渲染" class="sidebar-link">1.11 列表渲染</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-12-template模板" class="sidebar-link">1.12 template模板</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-13-全局变量" class="sidebar-link">1.13 全局变量</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-14-页面跳转，页面栈概念" class="sidebar-link">1.14 页面跳转，页面栈概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#wx-navigateto" class="sidebar-link">wx.navigateTo()</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#页面栈" class="sidebar-link">页面栈</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#页面通信" class="sidebar-link">页面通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-15-wx-request" class="sidebar-link">1.15 wx.request</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-16-云函数" class="sidebar-link">1.16 云函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#云函数定时触发器" class="sidebar-link">云函数定时触发器</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-17-数据库" class="sidebar-link">1.17 数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#获取数据库引用" class="sidebar-link">获取数据库引用</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#连接集合" class="sidebar-link">连接集合</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#添加数据" class="sidebar-link">添加数据</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#查询" class="sidebar-link">查询</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#更新" class="sidebar-link">更新</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#删除数据" class="sidebar-link">删除数据</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#聚合" class="sidebar-link">聚合</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-18-云存储" class="sidebar-link">1.18 云存储</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-19-behaviors" class="sidebar-link">1.19 behaviors</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#字段的覆盖和组合规则" class="sidebar-link">字段的覆盖和组合规则</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-20-component构造器" class="sidebar-link">1.20 Component构造器</a></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-21-组件间通信" class="sidebar-link">1.21 组件间通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/wx/#类似事件车通信" class="sidebar-link">类似事件车通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/wx/#_1-22-小程序动态类名绑定" class="sidebar-link">1.22 小程序动态类名绑定</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="小程序"><a href="#小程序" class="header-anchor">#</a> 小程序</h1> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/" target="_blank" rel="noopener noreferrer">官方文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h1 id="_1-基础部分"><a href="#_1-基础部分" class="header-anchor">#</a> 1. 基础部分</h1> <p>本篇文章旨在快速上手小程序，在有 Vue 作为前置知识的情况下，理解。</p> <h2 id="_1-1-rpx-wxss"><a href="#_1-1-rpx-wxss" class="header-anchor">#</a> 1.1 rpx wxss</h2> <h3 id="wxss小程序样式特性："><a href="#wxss小程序样式特性：" class="header-anchor">#</a> wxss小程序样式特性：</h3> <p><strong>尺寸单位 <code>rpx</code> 核心点</strong>。移动设备的分辨率与rpx：</p> <table><thead><tr><th>设备</th> <th>屏幕尺寸</th> <th>分辨率(px)</th> <th>reader</th> <th>分辨率(pt)</th> <th>PPI(DPI)</th></tr></thead> <tbody><tr><td>iPhone 3GS</td> <td>3.5</td> <td>320*480</td> <td>@1x</td> <td>320*480</td> <td>163</td></tr> <tr><td>iPhone 4/4s</td> <td>3.5</td> <td>640*960</td> <td>@2x</td> <td>320*480</td> <td>326</td></tr> <tr><td>iPhone 5/5S/5C</td> <td>4</td> <td>640*1136</td> <td>@2x</td> <td>320*568</td> <td>326</td></tr> <tr><td><strong>iPhone 6/6S</strong></td> <td><strong>4.7</strong></td> <td><strong>750*1334</strong></td> <td><strong>@2x</strong></td> <td><strong>375*667</strong></td> <td><strong>326</strong></td></tr> <tr><td>iPhone 6/6S Plus</td> <td>5.5</td> <td>1242*2208</td> <td>@3x</td> <td>414*736</td> <td>401</td></tr></tbody></table> <p>通常以 iphone6s 为基准</p> <img src="/docs/wx/rpx.png" alt="rpx.png"> <img src="/docs/wx/PPI.png" alt="PPI.png"> <p>假设设计稿就按照iphone6S的尺寸来模拟，UI工程师给我们的素材是750宽的，换算到小程序的px那就是375px即750rpx。</p> <p>以iphone 6s设备的尺寸作为基准值定义在 iPhone 6s的情况下 <strong>一个物理分辨率=1rpx=0.5px</strong> 然后在不同的分辨率的情况下, 我们把rpx与px的换算比率进行自动调整</p> <img src="/docs/wx/750rpx.png" alt="750rpx.png"> <table><thead><tr><th>设备</th> <th>rpx换算px (屏幕宽度/750)</th> <th>px换算rpx (750/屏幕宽度)</th></tr></thead> <tbody><tr><td>iPhone5</td> <td>1rpx = 0.42px</td> <td>1px = 2.34rpx</td></tr> <tr><td><strong>iPhone6</strong></td> <td><strong>1rpx = 0.5px</strong></td> <td><strong>1px = 2rpx</strong></td></tr> <tr><td>iPhone6 Plus</td> <td>1rpx = 0.552px</td> <td>1px = 1.81rpx</td></tr></tbody></table> <h3 id="wxss-选择器"><a href="#wxss-选择器" class="header-anchor">#</a> wxss 选择器</h3> <table><thead><tr><th>选择器</th> <th>样例</th> <th>样例描述</th></tr></thead> <tbody><tr><td><strong>.class</strong></td> <td><strong>.intro</strong></td> <td><strong>选择所有拥有 class=&quot;intro&quot; 的组件</strong></td></tr> <tr><td>#id</td> <td>#firstname</td> <td>选择拥有 id=&quot;firstname&quot; 的组件</td></tr> <tr><td>element</td> <td>view</td> <td>选择所有 view 组件</td></tr> <tr><td>element, element</td> <td>view, checkbox</td> <td>选择所有文档的 view 组件和所有的 checkbox 组件</td></tr> <tr><td>::after</td> <td>view::after</td> <td>在 view 组件后边插入内容</td></tr> <tr><td>::before</td> <td>view::before</td> <td>在 view 组件前边插入内容</td></tr></tbody></table> <p><strong>wxss 不支持 <code>&gt; + ~</code> 等等，推荐使用类名选择器</strong>。</p> <ul><li>样式导入</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@import</span> <span class="token string">'./test.wxss'</span><span class="token punctuation">;</span></span><span class="token comment">/**会被编译到目标文件，不会产生多与文件请求**/</span>
<span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>'/test.wxss'<span class="token punctuation">)</span></span><span class="token punctuation">;</span></span><span class="token comment">/**这种写法，不会打包合并，会产生文件请求**/</span>
</code></pre></div><ul><li>样式优先级</li></ul> <p><code>!important：∞ &gt; 内联style:1000 &gt; #id:100 &gt; .class:10 &gt; 标签选择器element:1</code></p> <h2 id="_1-2-小程序结构"><a href="#_1-2-小程序结构" class="header-anchor">#</a> 1.2 小程序结构</h2> <img src="/docs/wx/wxapp01.png" alt="wxapp01.png"> <img src="/docs/wx/wxapp02.png" alt="wxapp02.png"> <h3 id="入口文件-app-js"><a href="#入口文件-app-js" class="header-anchor">#</a> 入口文件 <code>app.js</code></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>地位类似于 Vue 里面的 index.js 整个小程序只有一个 App 实例，是全部页面共享的。开发者可以通过 getApp 方法获取到全局唯一的 App 实例，获取App上的数据或调用开发者注册在 App 上的函数。</p> <p>鉴于小程序没有类似Vuex之类的全局的数据管理工具，因此一般我们需要在多个页面使用到的变量数据，就存在app.js里面的globalData里面。</p> <h3 id="全局配置文件-app-json"><a href="#全局配置文件-app-json" class="header-anchor">#</a> 全局配置文件 app.json</h3> <p>app.json 是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;pages/logs/logs&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;window&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;backroundTextStyle&quot;</span><span class="token operator">:</span><span class="token string">&quot;light&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;navigationBarBackgroundColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span><span class="token string">&quot;WeChat&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;navigationBarTextStyle&quot;</span><span class="token operator">:</span><span class="token string">&quot;black&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;style&quot;</span><span class="token operator">:</span><span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sitemapLocation&quot;</span><span class="token operator">:</span><span class="token string">&quot;sitemap.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>pages字段：用于描述当前小程序所有页面路径，这是为了让微信客户端知道当前你的小程序页面定义在哪个目录。当我们新建页面时，根据新建方法的不同，需要检查pages。也可以直接在pages新增配置来自动创建页面。</p> <p>window字段： 定义小程序所有页面的顶部背景颜色，文字颜色定义等。</p> <p>style字段：指定使用weui样式的版本。</p> <p>sitemapLocation：指明 sitemap.json 的位置。</p> <h2 id="_1-3-小程序生命周期"><a href="#_1-3-小程序生命周期" class="header-anchor">#</a> 1.3 小程序生命周期</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onLaunch</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 小程序初始化完成时触发，全局只触发一次。参数也可以使用 wx.getLaunchOptionsSync 获取。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 小程序启动，或从后台进入前台显示时触发。也可以使用 wx.onAppShow 绑定监听。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onHide</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 小程序从前台进入后台时触发。也可以使用 wx.onAppHide 绑定监听。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 小程序发生脚本错误或 API 调用报错时触发。也可以使用 wx.onError 绑定监听。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  globalData<span class="token operator">:</span> <span class="token string">'I am global data'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_1-4-小程序页面生命周期"><a href="#_1-4-小程序页面生命周期" class="header-anchor">#</a> 1.4 小程序页面生命周期</h2> <p>page生命周期是微信客户端根据用户操作主动处罚的</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面创建时执行，页面销毁前只会触发一次，在这里可以拿到上一个页面传递的数据</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面出现在前台时执行，页面第一次显示、从其他页面返回都会触发</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面首次渲染完毕时执行，页面销毁前只会触发一次</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onHide</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面从前台变为后台时执行，使用 wx.navigateTo 跳转，或底部tab切换页面会触发</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onUnload</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面销毁时执行，使用 wx.redirectTo 或 wx.navigateBack 返回，当前页面被销毁</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_1-5-用户行为"><a href="#_1-5-用户行为" class="header-anchor">#</a> 1.5 用户行为</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">onPullDownRefresh</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 触发下拉刷新时执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onReachBottom</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面触底时执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onShareAppMessage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面被用户分享时执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onPageScroll</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面滚动时执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">onResize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 页面尺寸变化时执行</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="onpulldownrefresh"><a href="#onpulldownrefresh" class="header-anchor">#</a> onPullDownRefresh</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html" target="_blank" rel="noopener noreferrer">文档：API&gt;界面&gt;下拉刷新&gt;wx.startPullDownRefresh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>监听用户下拉</p> <blockquote><p>需要在<code>app.json</code>的<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window" target="_blank" rel="noopener noreferrer"><code>window</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>选项中或<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html" target="_blank" rel="noopener noreferrer">页面配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中开启<code>enablePullDownRefresh</code>。</p> <p>可以通过<a href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html" target="_blank" rel="noopener noreferrer">wx.startPullDownRefresh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>触发下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。</p> <p>当处理完数据刷新后，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.stopPullDownRefresh.html" target="_blank" rel="noopener noreferrer">wx.stopPullDownRefresh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以停止当前页面的下拉刷新。</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;enablePullDownRefresh&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
</code></pre></div><h3 id="onshareappmessage"><a href="#onshareappmessage" class="header-anchor">#</a> onShareAppMessage</h3> <p>定义此方法后，右上角才会显示分享按钮，需要 return 一个配置对象，自定义分享内容。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">onShareAppMessage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span><span class="token string">'自定义转发标题'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span><span class="token string">'转发路径，默认当前页面 path ，必须是以 / 开头的完整路径'</span><span class="token punctuation">,</span>
        imageUrl<span class="token operator">:</span><span class="token string">'自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径。支持PNG及JPG。显示图片长宽比是 5:4，默认为截图'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_1-6-简易双向数据绑定"><a href="#_1-6-简易双向数据绑定" class="header-anchor">#</a> 1.6 简易双向数据绑定</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/two-way-bindings.html" target="_blank" rel="noopener noreferrer">文档：指南&gt;小程序框架&gt;视图层&gt;简易双向绑定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>只能是一个单一字段的数据，不能绑定对象的某个属性</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input model<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;{{inputVal}}&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="_1-7-事件"><a href="#_1-7-事件" class="header-anchor">#</a> 1.7 事件</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3" target="_blank" rel="noopener noreferrer">官方文档详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <table><thead><tr><th>类型</th> <th>触发条件</th></tr></thead> <tbody><tr><td>touchstart</td> <td>手指触摸动作开始</td></tr> <tr><td>touchmove</td> <td>手指触摸后移动</td></tr> <tr><td>touchcancel</td> <td>手指触摸动作被打断，如来电提醒，弹窗</td></tr> <tr><td>touchend</td> <td>手指触摸动作结束</td></tr> <tr><td><strong>tap</strong></td> <td><strong>点击，手指触摸后马上离开</strong></td></tr> <tr><td>longpress</td> <td>手指触摸后，超过350ms再离开，如果指定了事件回调函数并触发了这个事件，tap事件将不被触发</td></tr> <tr><td><strong>longtap</strong></td> <td><strong>长按，手指触摸后，超过350ms再离开（推荐使用longpress事件代替）</strong></td></tr> <tr><td>transitionend</td> <td>会在 WXSS transition 或 wx.createAnimation 动画结束后触发</td></tr> <tr><td>animationstart</td> <td>会在一个 WXSS animation 动画开始时触发</td></tr> <tr><td>animationiteration</td> <td>会在一个 WXSS animation 一次迭代结束时触发</td></tr> <tr><td>animationend</td> <td>会在一个 WXSS animation 动画完成时触发</td></tr> <tr><td>touchforcechange</td> <td>在支持 3D Touch 的 iPhone 设备，重按时会触发</td></tr></tbody></table> <p>事件绑定：bind</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>view bindtap<span class="token operator">=</span><span class="token string">&quot;handleTap&quot;</span><span class="token operator">&gt;</span>
    Click here<span class="token operator">!</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
</code></pre></div><p>绑定并阻止事件冒泡：catch</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>view catchtap<span class="token operator">=</span><span class="token string">&quot;handleTap&quot;</span><span class="token operator">&gt;</span>
    Click here<span class="token operator">!</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_1-8-setdata-方法"><a href="#_1-8-setdata-方法" class="header-anchor">#</a> 1.8 setData 方法</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/performance/tips.html" target="_blank" rel="noopener noreferrer">官方文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>callBack<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//callBack在本次setData对界面渲染完毕后触发</span>
</code></pre></div><p>原则上：每次只设置需要改变的最小单位数据，同一个事件里合并多次setData</p> <h3 id="setdata理解"><a href="#setdata理解" class="header-anchor">#</a> setData理解</h3> <p><code>Page</code>实例原型中中<code>setData</code>方法，小程序的渲染层 <code>WebView</code> 和逻辑层 <code>JavascriptCore</code> 是在两个线程中运行，彼此独立，并不具备数据直接共享的通道。当前，视图层和逻辑层的数据传输，实际上通过两边提供的 <code>evaluateJavascript</code> 所实现。即用户传输的数据，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境。</p> <h3 id="setdata几种操作不可取"><a href="#setdata几种操作不可取" class="header-anchor">#</a> setData几种操作不可取</h3> <ul><li>1.频繁调用setData</li></ul> <p>部分小程序非常频繁（毫秒级）的去<code>setData</code>，其导致了两个后果：</p> <p>Android 下用户在滑动时会感觉到卡顿，操作反馈延迟严重，因为 JS 线程一直在编译执行渲染，未能及时将用户操作事件传递到逻辑层，逻辑层亦无法及时将操作处理结果及时传递到视图层；</p> <p>渲染有出现延时，由于 WebView 的 JS 线程一直处于忙碌状态，逻辑层到页面层的通信耗时上升，视图层收到的数据消息时距离发出时间已经过去了几百毫秒，渲染的结果并不实时；</p> <ul><li>2.每次setData传递大量数据</li></ul> <p>由<code>setData</code>的底层实现可知，我们的数据传输实际是一次 <code>evaluateJavascript</code> 脚本过程，当数据量过大时会增加脚本的编译执行时间，占用 WebView JS 线程。</p> <ul><li>3.后台页面进行setData</li></ul> <p>当页面进入后台态（用户不可见），不应该继续去进行<code>setData</code>，后台态页面的渲染用户是无法感受的，另外后台态页面去<code>setData</code>也会抢占前台页面的执行。</p> <h2 id="_1-9-插值"><a href="#_1-9-插值" class="header-anchor">#</a> 1.9 插值</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/data.html" target="_blank" rel="noopener noreferrer">文档地址：框架&gt;WXML语法参考&gt;数据绑定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>数据用双花括号插值，可以进行运算，简单的三目，算术，逻辑运算等。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
	{{message}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">model:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{message}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><h2 id="_1-10-条件渲染"><a href="#_1-10-条件渲染" class="header-anchor">#</a> 1.10 条件渲染</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/conditional.html" target="_blank" rel="noopener noreferrer">文档地址：框架&gt;WXML语法参考&gt;条件渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>wx:if</code>条件渲染符合 vue 语法，判断多个组件或标签时可使用<code>&lt;block&gt;&lt;/block&gt;</code>占位标签，减少无意义标签。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>elif</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">&gt;</span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>hidden</code>相当于 <code>Vue v-show</code>，组件始终会被渲染，只是简单的控制显示与隐藏。</p> <p>如果频繁切换状态，<code>wx:if</code>控制组件销毁和渲染，会产生非常大的性能开销，使用<code>hidden</code>优化。</p> <h2 id="_1-11-列表渲染"><a href="#_1-11-列表渲染" class="header-anchor">#</a> 1.11 列表渲染</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/list.html" target="_blank" rel="noopener noreferrer">文档地址：框架&gt;WXML语法参考&gt;列表渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>wx:for</code>，默认数组的当前项的下标变量名默认为 <code>index</code>，数组当前项的变量名默认为 <code>item</code> ，可使用<code>&lt;block&gt;&lt;/block&gt;</code>占位标签，减少无意义标签。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{List}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	{{index}}--{{item}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>需要指定别名：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{List}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>idx<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>itemName<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
	{{idx}}--{{itemName}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>wx:key</strong>同样，key唯一标识很重要</p> <h2 id="_1-12-template模板"><a href="#_1-12-template模板" class="header-anchor">#</a> 1.12 template模板</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/template.html" target="_blank" rel="noopener noreferrer">文档地址：框架&gt;WXML语法参考&gt;模板<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>新建模板<code>/template/list-template/list-template.wxml</code>，模板样式<code>/template/list-template/list-template.wxss</code>，检查app.json pages注册。</p> <p>模板和组件场景，如果没有交互，用模板。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--list-template.wxml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>list<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>list-wrapper<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>list-text<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>{{templateData.msg}}--hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/**list-template.wxss**/</span>
<span class="token selector">.list-wrapper</span><span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span>#ddd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.list-text</span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span>16px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用模板</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--index.wxml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/template/list-template/list-template.wxml<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>list<span class="token punctuation">'</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{{templateData}}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>样式需要单独引入</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/**index.wxss**/</span>
<span class="token atrule"><span class="token rule">@import</span> <span class="token string">'/template/list-template/list-template.wxss'</span><span class="token punctuation">;</span></span>
</code></pre></div><h2 id="_1-13-全局变量"><a href="#_1-13-全局变量" class="header-anchor">#</a> 1.13 全局变量</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/module.html#%E6%96%87%E4%BB%B6%E4%BD%9C%E7%94%A8%E5%9F%9F" target="_blank" rel="noopener noreferrer">文档地址：指南&gt;小程序框架&gt;逻辑层&gt;模块化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>通过全局函数 <code>getApp</code> 可以获取全局的应用实例，如果需要全局的数据可以在 <code>App()</code> 中设置，如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//app.js 入口文件中定义，保证后续都能访问</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    globalData<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//在 a.js 访问</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//在 b.js 访问</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>globalData<span class="token operator">++</span>
</code></pre></div><h2 id="_1-14-页面跳转，页面栈概念"><a href="#_1-14-页面跳转，页面栈概念" class="header-anchor">#</a> 1.14 页面跳转，页面栈概念</h2> <table><thead><tr><th>路由方式</th> <th>触发时机</th> <th>路由前页面</th> <th>路由后页面</th></tr></thead> <tbody><tr><td>初始化</td> <td>小程序打开的第一个页面</td> <td></td> <td>onLoad, onShow</td></tr> <tr><td>打开新页面</td> <td>调用 API <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html" target="_blank" rel="noopener noreferrer">wx.navigateTo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用组件 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html" target="_blank" rel="noopener noreferrer">``<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>onHide</td> <td>onLoad, onShow</td></tr> <tr><td>页面重定向</td> <td>调用 API <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.redirectTo.html" target="_blank" rel="noopener noreferrer">wx.redirectTo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用组件 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html" target="_blank" rel="noopener noreferrer">``<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>onUnload</td> <td>onLoad, onShow</td></tr> <tr><td>页面返回</td> <td>调用 API <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html" target="_blank" rel="noopener noreferrer">wx.navigateBack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用组件<a href="https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html" target="_blank" rel="noopener noreferrer">``<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用户按左上角返回按钮</td> <td>onUnload</td> <td>onShow</td></tr> <tr><td>Tab 切换</td> <td>调用 API <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.switchTab.html" target="_blank" rel="noopener noreferrer">wx.switchTab<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用组件 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html" target="_blank" rel="noopener noreferrer">``<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用户切换 Tab</td> <td></td> <td>各种情况请参考下表</td></tr> <tr><td>重启动</td> <td>调用 API <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.reLaunch.html" target="_blank" rel="noopener noreferrer">wx.reLaunch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用组件 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html" target="_blank" rel="noopener noreferrer">``<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>onUnload</td> <td>onLoad, onShow</td></tr></tbody></table> <p><strong>wx.navigateTo()和wx.redirectTo()只能打开非tabBar页面。</strong></p> <p>使用 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html" target="_blank" rel="noopener noreferrer">wx.navigateBack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以返回到原页面。小程序中页面栈最多十层。</p> <h3 id="wx-navigateto"><a href="#wx-navigateto" class="header-anchor">#</a> wx.navigateTo()</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html" target="_blank" rel="noopener noreferrer">文档：API&gt;路由&gt;wx.navigateTo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>保留当前页面，跳转到应用内的某个页面，但是不能跳到 tabbar 页面。</p> <p>参数：</p> <table><thead><tr><th>属性</th> <th>类型</th> <th>默认值</th> <th>必填</th> <th>说明</th></tr></thead> <tbody><tr><td>url</td> <td>string</td> <td></td> <td>是</td> <td>需要跳转的应用内非 tabBar 的页面的路径 (代码包路径), 路径后可以带参数。参数与路径之间使用 <code>?</code> 分隔，参数键与参数值用 <code>=</code> 相连，不同参数用 <code>&amp;</code> 分隔；如 'path?key=value&amp;key2=value2'</td></tr> <tr><td>events</td> <td>Object</td> <td></td> <td>否</td> <td>页面间通信接口，用于监听被打开页面发送到当前页面的数据。基础库 2.7.3 开始支持。</td></tr> <tr><td>success</td> <td>function</td> <td></td> <td>否</td> <td>接口调用成功的回调函数</td></tr> <tr><td>fail</td> <td>function</td> <td></td> <td>否</td> <td>接口调用失败的回调函数</td></tr> <tr><td>complete</td> <td>function</td> <td></td> <td>否</td> <td>接口调用结束的回调函数（调用成功、失败都会执行</td></tr></tbody></table> <h3 id="页面栈"><a href="#页面栈" class="header-anchor">#</a> 页面栈</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html" target="_blank" rel="noopener noreferrer">文档：指南&gt;小程序框架&gt;页面路由<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>wx.navigateTo()</code>使用两次后，页面层级有3层，这样的页面层级关系就是页面栈，页面栈最多十层。</p> <p>首页pageA<code>wx.navigateTo()</code>--&gt;页面pageB<code>wx.navigateTo()</code>--&gt;详情页pageC</p> <p>描述为：[pageA，pageB，pageC]，C是当前所处页面，最上层，A为最根层。</p> <p>当前页pageC <code>wx.navigateTo(url:pageD)</code>--&gt;[pageA，pageB，pageC，pageD]</p> <ul><li><h4 id="结合页面生命周期理解："><a href="#结合页面生命周期理解：" class="header-anchor">#</a> 结合页面生命周期理解：</h4></li></ul> <p>当前页pageD <code>wx.navigateBack()</code> --&gt;[pageA，pageB，pageC]，此时D被回收调用pageD.onUnload()，pageC.onShow()</p> <p>当前页pageC <code>wx.redirectTo(url:pageE)</code> --&gt;[pageA，pageB，pageE]，此时pageC.onUnload()，pageE.onLoad()，pageE.onshow()，pageE.onReady()</p> <ul><li><h4 id="结合tabbar"><a href="#结合tabbar" class="header-anchor">#</a> 结合tabBar</h4></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>tabBar<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string">&quot;list&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;tab1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pagePath&quot;</span><span class="token operator">:</span><span class="token string">&quot;pageA&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;tab2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pagePath&quot;</span><span class="token operator">:</span><span class="token string">&quot;pageF&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;tab3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pagePath&quot;</span><span class="token operator">:</span><span class="token string">&quot;pageG&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当前页pageE <code>wx.switchTab(url:pageF)</code>，此时原来的页面栈会被全部清空（除了pageA）。此时的页面栈 [pageF]，此时点击 tab1 切换到 pageA ，pageA 不会触发 onLoad()，pageA没有被销毁。</p> <h3 id="页面通信"><a href="#页面通信" class="header-anchor">#</a> 页面通信</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html" target="_blank" rel="noopener noreferrer">文档：API&gt;路由&gt;wx.navigateTo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>如果一个页面由另一个页面通过 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html" target="_blank" rel="noopener noreferrer"><code>wx.navigateTo</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 打开，这两个页面间将建立一条数据通道：</p> <ul><li>被打开的页面可以通过 <code>this.getOpenerEventChannel()</code> 方法来获得一个 <code>EventChannel</code> 对象；</li> <li><code>wx.navigateTo</code> 的 <code>success</code> 回调中也包含一个 <code>EventChannel</code> 对象。</li></ul> <p>这两个 <code>EventChannel</code> 对象间可以使用 <code>emit</code> 和 <code>on</code> 方法相互发送、监听事件。</p> <h2 id="_1-15-wx-request"><a href="#_1-15-wx-request" class="header-anchor">#</a> 1.15 wx.request</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html" target="_blank" rel="noopener noreferrer">文档地址：API&gt;网络&gt;发起请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <table><thead><tr><th>属性</th> <th>类型</th> <th>默认值</th> <th>必填</th> <th>说明</th> <th>最低版本</th></tr></thead> <tbody><tr><td>url</td> <td>string</td> <td></td> <td>是</td> <td>开发者服务器接口地址</td> <td></td></tr> <tr><td>data</td> <td>string/object/ArrayBuffer</td> <td></td> <td>否</td> <td>请求的参数</td> <td></td></tr> <tr><td>header</td> <td>Object</td> <td></td> <td>否</td> <td>设置请求的 header，header 中不能设置 Referer。 <code>content-type</code> 默认为 <code>application/json</code></td> <td></td></tr> <tr><td>timeout</td> <td>number</td> <td></td> <td>否</td> <td>超时时间，单位为毫秒</td> <td><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">2.10.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td>method</td> <td>string</td> <td>GET</td> <td>否</td> <td>HTTP 请求方法</td> <td></td></tr> <tr><td>dataType</td> <td>string</td> <td>json</td> <td>否</td> <td>返回的数据格式</td> <td></td></tr> <tr><td>responseType</td> <td>string</td> <td>text</td> <td>否</td> <td>响应的数据类型</td> <td><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">1.7.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td>enableHttp2</td> <td>boolean</td> <td>false</td> <td>否</td> <td>开启 http2</td> <td><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">2.10.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td>enableQuic</td> <td>boolean</td> <td>false</td> <td>否</td> <td>开启 quic</td> <td><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">2.10.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td>enableCache</td> <td>boolean</td> <td>false</td> <td>否</td> <td>开启 cache</td> <td><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">2.10.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td>success</td> <td>function</td> <td></td> <td>否</td> <td>接口调用成功的回调函数</td> <td></td></tr> <tr><td>fail</td> <td>function</td> <td></td> <td>否</td> <td>接口调用失败的回调函数</td> <td></td></tr> <tr><td>complete</td> <td>function</td> <td></td> <td>否</td> <td>接口调用结束的回调函数（调用成功、失败都会执行）</td> <td></td></tr></tbody></table> <p>示例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">'test.php'</span><span class="token punctuation">,</span> <span class="token comment">//仅为示例，并非真实的接口地址</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    x<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    y<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  header<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token comment">// 默认值</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_1-16-云函数"><a href="#_1-16-云函数" class="header-anchor">#</a> 1.16 云函数</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/init/server.init.html" target="_blank" rel="noopener noreferrer">云函数文档：云开发&gt;基础&gt;云开发能力&gt;云函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>云开发简单理解就是一个nodejs服务</p> <p>云开发注意问题：需要安装依赖，云函数本地调试报错是由于热更新，逻辑没写完，不用管。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 云函数入口文件</span>
<span class="token keyword">const</span> cloud <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'wx-server-sdk'</span><span class="token punctuation">)</span>
cloud<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 云函数入口函数</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wxContext <span class="token operator">=</span> cloud<span class="token punctuation">.</span><span class="token function">getWXContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">//返回一个对象</span>
        event<span class="token punctuation">,</span>
        openid<span class="token operator">:</span> wxContext<span class="token punctuation">.</span><span class="token constant">OPENID</span><span class="token punctuation">,</span>
        appid<span class="token operator">:</span> wxContext<span class="token punctuation">.</span><span class="token constant">APPID</span><span class="token punctuation">,</span>
        unionid<span class="token operator">:</span> wxContext<span class="token punctuation">.</span><span class="token constant">UNIONID</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>调用云函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">callFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'云函数名'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//要发送给云函数的数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="云函数定时触发器"><a href="#云函数定时触发器" class="header-anchor">#</a> 云函数定时触发器</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/functions/triggers.html" target="_blank" rel="noopener noreferrer">云函数文档：云开发&gt;开发指引&gt;云函数&gt;定时触发器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>如果云函数需要定时 / 定期执行，也就是定时触发，我们可以使用云函数定时触发器。配置了定时触发器的云函数，会在相应时间点被自动触发，函数的返回结果不会返回给调用方。</p> <p>在需要添加触发器的云函数目录下新建文件 <code>config.json</code>，格式如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// triggers 字段是触发器数组，目前仅支持一个触发器，即数组只能填写一个，不可添加多个</span>
  <span class="token property">&quot;triggers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// name: 触发器的名字，规则见下方说明</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myTrigger&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// type: 触发器类型，目前仅支持 timer (即 定时触发器)</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;timer&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// config: 触发器配置，在定时触发器下，config 格式为 cron 表达式，规则见下方说明</span>
      <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0 0 2 1 * * *&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>config触发器触发周期，标准corn表达式</p> <table><thead><tr><th>第一位</th> <th>第二位</th> <th>第三位</th> <th>第四位</th> <th>第五位</th> <th>第六位</th> <th>第七位</th></tr></thead> <tbody><tr><td>秒</td> <td>分钟</td> <td>小时</td> <td>日</td> <td>月</td> <td>星期</td> <td>年</td></tr></tbody></table> <p>！！！！！！配置完成记得上传触发器</p> <h2 id="_1-17-数据库"><a href="#_1-17-数据库" class="header-anchor">#</a> 1.17 数据库</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/add.html" target="_blank" rel="noopener noreferrer">数据库文档：云开发&gt;开发指引&gt;数据库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>需要注意：云函数里使用数据库操作只能用 promise 不能用回调，回调有问题，并且小程序容易抽风，重启解决大部分问题。</p> <p>小程序数据库是文档型数据库，类似mongodb，比关系型数据库简单。</p> <h3 id="获取数据库引用"><a href="#获取数据库引用" class="header-anchor">#</a> 获取数据库引用</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="连接集合"><a href="#连接集合" class="header-anchor">#</a> 连接集合</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token comment">//连接message集合</span>
</code></pre></div><h3 id="添加数据"><a href="#添加数据" class="header-anchor">#</a> 添加数据</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// addMessage云函数入口文件</span>
<span class="token keyword">const</span> cloud <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'wx-server-sdk'</span><span class="token punctuation">)</span>
cloud<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//获取数据库引用</span>
<span class="token comment">// 云函数入口函数</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//连接message集合</span>
            data<span class="token operator">:</span> <span class="token punctuation">{</span>
                age<span class="token operator">:</span>event<span class="token punctuation">.</span>age<span class="token punctuation">,</span>
                author<span class="token operator">:</span>event<span class="token punctuation">.</span>author<span class="token punctuation">,</span>
                content<span class="token operator">:</span> event<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
                time<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//通过云函数调用</span>
<span class="token function">addMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">callFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'addMessage'</span><span class="token punctuation">,</span><span class="token comment">//云函数名</span>
        data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//传递数据给云函数</span>
            age<span class="token operator">:</span><span class="token string">'18'</span><span class="token punctuation">,</span>
            author<span class="token operator">:</span><span class="token string">'十月'</span><span class="token punctuation">,</span>
            content<span class="token operator">:</span><span class="token string">'第一条数据，今天五月18日'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment">//添加成功返回的是数据的_id</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/read.html" target="_blank" rel="noopener noreferrer">文档：云开发&gt;开发指引&gt;数据库&gt;增删改查SDK&gt;查询<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>where</code> 方法接收一个对象参数，该对象中每个字段和它的值构成一个需满足的匹配条件，<strong>各个字段间的关系是 &quot;与&quot; 的关系</strong>，即需同时满足这些匹配条件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// getMessage云函数入口文件</span>
<span class="token keyword">const</span> cloud <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'wx-server-sdk'</span><span class="token punctuation">)</span>
cloud<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 云函数入口函数</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//where查询条件</span>
            author<span class="token operator">:</span>event<span class="token punctuation">.</span>author
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//get()返回的是promise</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//通过云函数调用</span>
<span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">callFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'getMessage'</span><span class="token punctuation">,</span><span class="token comment">//云函数名</span>
        data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//传递数据给云函数</span>
        	author<span class="token operator">:</span><span class="token string">'十月'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token comment">//查询得到的数据是array</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>不使用云函数，直接查询也可以。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//promise写法，get()返回的是promise</span>
<span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	author<span class="token operator">:</span><span class="token string">'十月'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//get()回调写法</span>
<span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	author<span class="token operator">:</span><span class="token string">'十月'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><strong>查询指令的坑：云函数内使用get()方法，只能使用promise形式，不能用<code>get({success(res){console.log(res)}})</code>回调方式</strong>。</p> <p>使用数据库 API 提供的 where 方法我们可以构造复杂的查询条件完成复杂的查询任务. 数据库 API 提供了大于、小于等多种查询指令，这些指令都暴露在 db.command 对象上。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token comment">//查询age&gt;18</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>查询指令</p> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/query.html" target="_blank" rel="noopener noreferrer">文档：云开发&gt;开发指引&gt;数据库&gt;增删改查SDK&gt;查询指令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <table><thead><tr><th>查询指令</th> <th>说明</th></tr></thead> <tbody><tr><td>eq</td> <td>等于</td></tr> <tr><td>neq</td> <td>不等于</td></tr> <tr><td>lt</td> <td>小于</td></tr> <tr><td>lte</td> <td>小于或等于</td></tr> <tr><td>gt</td> <td>大于</td></tr> <tr><td>gte</td> <td>大于或等于</td></tr> <tr><td>in</td> <td>字段值在给定数组中</td></tr> <tr><td>nin</td> <td>字段值不在给定数组中</td></tr></tbody></table> <p>查询多个条件</p> <p><code>&amp;&amp;</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//查询 age&gt;18 &amp;&amp; age&lt;25</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>||</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//查询 age=18 || age=25</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>非</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//查询 age!==18</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_<span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//非（小于50或等于100）--&gt;大于50且不等于100</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//简化写法nor</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">nor</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_<span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//非（小于50或等于100）--&gt;大于50且不等于100</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>多个字段非</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//筛选出age不小于20 且 tags 不包含'mini'</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> _ <span class="token operator">=</span> db<span class="token punctuation">.</span>command
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">nor</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    age<span class="token operator">:</span>_<span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    tags<span class="token operator">:</span><span class="token string">'mini'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	conso
</code></pre></div><h3 id="更新"><a href="#更新" class="header-anchor">#</a> 更新</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/update.html" target="_blank" rel="noopener noreferrer">文档：云开发&gt;开发指引&gt;数据库&gt;增删改查SDK&gt;更新<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>改一定是在查之后，先查再改。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// updateMessage云函数入口文件</span>
<span class="token keyword">const</span> cloud <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'wx-server-sdk'</span><span class="token punctuation">)</span>
cloud<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 云函数入口函数</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>
            event<span class="token punctuation">.</span>condition<span class="token comment">//这样写让前端给查找条件{}</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            data<span class="token operator">:</span>event<span class="token punctuation">.</span>updateData
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//调用云函数</span>
<span class="token function">updateMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">callFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'updateMessage'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span><span class="token punctuation">{</span>
        	condition<span class="token operator">:</span><span class="token punctuation">{</span>author<span class="token operator">:</span><span class="token string">'十月'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//查询条件</span>
        	updateData<span class="token operator">:</span><span class="token punctuation">{</span>content<span class="token operator">:</span><span class="token string">'第一次之旅，假的假的'</span><span class="token punctuation">}</span><span class="token comment">//需要修改的数据</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'333'</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token comment">//更新返回的是stats:{updated:1}表示更新了几条数据</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了用指定值更新字段外，数据库 API 还提供了一系列的更新指令用于执行更复杂的更新操作，更新指令可以通过 <code>db.command</code> 取得：</p> <table><thead><tr><th>更新指令</th> <th>说明</th></tr></thead> <tbody><tr><td>set</td> <td>设置字段为指定值</td></tr> <tr><td>remove</td> <td>删除字段</td></tr> <tr><td>inc</td> <td>原子自增字段值</td></tr> <tr><td>mul</td> <td>原子自乘字段值</td></tr> <tr><td>push</td> <td>如字段值为数组，往数组尾部增加指定值</td></tr> <tr><td>pop</td> <td>如字段值为数组，从数组尾部删除一个元素</td></tr> <tr><td>shift</td> <td>如字段值为数组，从数组头部删除一个元素</td></tr> <tr><td>unshift</td> <td>如字段值为数组，往数组头部增加指定值</td></tr></tbody></table> <h3 id="删除数据"><a href="#删除数据" class="header-anchor">#</a> 删除数据</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/remove.html" target="_blank" rel="noopener noreferrer">文档：云开发&gt;开发指引&gt;数据库&gt;增删改查SDK&gt;删除数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="聚合"><a href="#聚合" class="header-anchor">#</a> 聚合</h3> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/aggregation/aggregation.html" target="_blank" rel="noopener noreferrer">文档：云开发&gt;开发指引&gt;数据库&gt;聚合<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>关联多个集合，联合查询，根据<code>authList</code>集合的<code>name</code>去关联查询<code>bookShop</code>集合的<code>author</code>，数据命名<code>personalFile</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'authList'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">from</span><span class="token operator">:</span><span class="token string">'bookShop'</span><span class="token punctuation">,</span>
    localField<span class="token operator">:</span><span class="token string">'name'</span><span class="token punctuation">,</span>
    foreignField<span class="token operator">:</span><span class="token string">'author'</span><span class="token punctuation">,</span>
    <span class="token keyword">as</span><span class="token operator">:</span><span class="token string">'personalFile'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_1-18-云存储"><a href="#_1-18-云存储" class="header-anchor">#</a> 1.18 云存储</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html" target="_blank" rel="noopener noreferrer">wx.chooseImage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>1.上传图片示例，<code>wx.cloud.upliadFile()</code>方法，<code>cloudPath</code> 云存储路径会解析<code>/</code>创建对应目录。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> type <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/.+\./</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//得到文件后缀名</span>
                wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    cloudPath<span class="token operator">:</span><span class="token string">'images/'</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> type<span class="token punctuation">,</span>
                    filePath<span class="token operator">:</span>item<span class="token punctuation">,</span>
                    <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上传成功'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回的数据拿到fileId</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_1-19-behaviors"><a href="#_1-19-behaviors" class="header-anchor">#</a> 1.19 behaviors</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/behaviors.html" target="_blank" rel="noopener noreferrer">文档：指南&gt;自定义组件&gt;behaviors<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>behaviors</code> 是用于组件间代码共享的特性，类似于Vue的“mixins”。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> mainBehavior <span class="token operator">=</span> <span class="token function">Behavior</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//数据</span>
    <span class="token punctuation">}</span>，
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> mainBehavior<span class="token punctuation">;</span>
</code></pre></div><p>使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> mainBehavior <span class="token keyword">from</span> <span class="token string">'..path'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    behaviors<span class="token operator">:</span><span class="token punctuation">[</span>mainBehavior<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//可使用多个behavior</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="字段的覆盖和组合规则"><a href="#字段的覆盖和组合规则" class="header-anchor">#</a> 字段的覆盖和组合规则</h3> <p>组件和它引用的 <code>behavior</code> 中可以包含同名的字段，对这些字段的处理方法如下：</p> <ul><li>如果有同名的属性或方法，组件本身的属性或方法会覆盖 <code>behavior</code> 中的属性或方法，如果引用了多个 <code>behavior</code> ，在定义段中靠后 <code>behavior</code> 中的属性或方法会覆盖靠前的属性或方法；</li> <li>如果有同名的数据字段，如果数据是对象类型，会进行对象合并，如果是非对象类型则会进行相互覆盖；</li> <li>生命周期函数不会相互覆盖，而是在对应触发时机被逐个调用。如果同一个 <code>behavior</code> 被一个组件多次引用，它定义的生命周期函数只会被执行一次。</li></ul> <h2 id="_1-20-component构造器"><a href="#_1-20-component构造器" class="header-anchor">#</a> 1.20 Component构造器</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/component.html" target="_blank" rel="noopener noreferrer">文档：指南&gt;自定义组件&gt;Component构造器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>Component</code> 构造器可用于定义组件，调用 <code>Component</code> 构造器时可以指定组件的属性、数据、方法等。</p> <h2 id="_1-21-组件间通信"><a href="#_1-21-组件间通信" class="header-anchor">#</a> 1.21 组件间通信</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html" target="_blank" rel="noopener noreferrer">文档：指南&gt;自定义组件&gt;组件间通信与事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>组件间的基本通信方式有以下几种。</p> <ul><li>WXML 数据绑定：用于父组件向子组件的指定属性设置数据，仅能设置 JSON 兼容数据（自基础库版本 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">2.0.9<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开始，还可以在数据中包含函数）。具体在 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html" target="_blank" rel="noopener noreferrer">组件模板和样式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 章节中介绍。</li> <li>事件：用于子组件向父组件传递数据，可以传递任意数据。</li> <li>如果以上两种方式不足以满足需要，父组件还可以通过 <code>this.selectComponent</code> 方法获取子组件实例对象，这样就可以直接访问组件的任意数据和方法。</li></ul> <h3 id="类似事件车通信"><a href="#类似事件车通信" class="header-anchor">#</a> 类似事件车通信</h3> <p>1.监听事件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 当自定义组件触发“myevent”事件时，调用“onMyEvent”方法 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>component<span class="token operator">-</span>tag<span class="token operator">-</span>name bindmyevent<span class="token operator">=</span><span class="token string">&quot;onMyEvent&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 或者可以写成 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>component<span class="token operator">-</span>tag<span class="token operator">-</span>name bind<span class="token operator">:</span>myevent<span class="token operator">=</span><span class="token string">&quot;onMyEvent&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onMyEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span>detail <span class="token comment">// 自定义组件触发事件时提供的detail对象</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>2.触发事件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在自定义组件中 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button bindtap<span class="token operator">=</span><span class="token string">&quot;onTap&quot;</span><span class="token operator">&gt;</span>点击这个按钮将触发“myevent”事件<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onTap</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> myEventDetail <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// detail对象，提供给事件监听函数</span>
      <span class="token keyword">var</span> myEventOption <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 触发事件的选项</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'myevent'</span><span class="token punctuation">,</span> myEventDetail<span class="token punctuation">,</span> myEventOption<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>触发事件的选项包括：</p> <table><thead><tr><th>选项名</th> <th>类型</th> <th>是否必填</th> <th>默认值</th> <th>描述</th></tr></thead> <tbody><tr><td>bubbles</td> <td>Boolean</td> <td>否</td> <td>false</td> <td>事件是否冒泡</td></tr> <tr><td>composed</td> <td>Boolean</td> <td>否</td> <td>false</td> <td>事件是否可以穿越组件边界，为false时，事件将只能在引用组件的节点树上触发，不进入其他任何组件内部</td></tr> <tr><td>capturePhase</td> <td>Boolean</td> <td>否</td> <td>false</td> <td>事件是否拥有捕获阶段</td></tr></tbody></table> <h2 id="_1-22-小程序动态类名绑定"><a href="#_1-22-小程序动态类名绑定" class="header-anchor">#</a> 1.22 小程序动态类名绑定</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{'type' + item.type}} mc-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
/*双括号内可用拼接 , 多个类名在双括号外空格隔开, item是wx:for得到的项, 结果如下*/
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>typeA mc-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-6-18 20:12:07</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.496b0931.js" defer></script><script src="/docs/assets/js/2.f90869d3.js" defer></script><script src="/docs/assets/js/42.e6e82b74.js" defer></script>
  </body>
</html>
